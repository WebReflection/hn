const e=self.requestIdleCallback||setTimeout,t=(e,t)=>new Promise(s=>{const a=document.createElement("script");a.onload=()=>s(self[t]),a.async=!0,a.src=e,document.head.appendChild(a)});Promise.all([t("../@/3rd/uhtml.js","uhtml"),t("../@/3rd/firebase.js","firebase"),import("./hn.js"),import("./view.js")]).then(([t,s,{default:a},{default:n}])=>{const{stories:o,story:r,item:i,user:c,parse:l}=a(s),{render:d,html:m}=t,{body:h}=document,{header:u,main:p,footer:f,about:b,details:g,profile:k,notFound:v}=n(t),y=()=>{h.classList.remove("loading")},j=(e,t)=>{d(h,m`${e}${t}${f()}`)},w=t=>{h.classList.add("loading");const{id:s,page:a,type:n,pathname:d,user:f}=l(t),w=u({page:a,header:{current:d,stories:o}});let L=!0;switch(n){case"item":i(s).then(t=>{if(t){e(y);const s=t=>{const n=i(t);return n.then(t=>{t&&(n.model=t,t.comments=(t.kids||[]).map(s),L&&(L=!L,e(a)))}),n},a=()=>{j(w,g(t)),L=!0};t.comments=(t.kids||[]).map(s),a()}else j(w,v())});break;case"story":r(d).then(t=>{e(y);const s=Math.ceil(t.length/20),n=20*(a-1),o=20*a,r=t.slice(n,o).map((t,s)=>{const a=i(t);return a.then(t=>{t&&(a.index=n+s+1,a.model=t,L&&(L=!L,e(c)))}),a}),c=()=>{j(w,p(r,a,s)),L=!0};c()});break;case"user":c(f).then(t=>{t?(e(y),j(w,k(t))):(e(y),j(w,v()))});break;default:if(/\/about\/$/.test(t)){const t=u({page:a,header:{current:"about",stories:o}});j(w,m`<main/>`),b().then(s=>{e(y),j(t,s)})}else e(y),j(w,v())}};self.SSR||w(location.href),h.addEventListener("click",e=>{const{target:t}=e,s=t.closest("a");if(s){const{href:t}=s,{hostname:a}=new URL(t);a===location.hostname&&(history.pushState(null,document.title,t),e.preventDefault(),w(t))}}),self.addEventListener("popstate",()=>{w(location.href)}),"serviceWorker"in navigator&&navigator.serviceWorker.register("../sw.js",{scope:"../"})});