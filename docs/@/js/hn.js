const e=(e,t)=>{e.delete(t)};export default(t,s=3e5)=>{t.initializeApp({databaseURL:"https://hacker-news.firebaseio.com"});const a=t.database().ref("v0"),n=["top","new","show","ask","job"],i=new Map,r=t=>i.get(t)||i.set(t,(t=>new Promise(n=>{a.child(t).once("value",a=>{const r=a.val();r?setTimeout(e,s,i,t):i.delete(t),n(r)})}))(t)).get(t);return{cache:i,stories:n,item:e=>r("item/"+e),user:e=>r("user/"+e),story:e=>r(e+"stories"),parse:e=>{const t={type:"unknown",id:-1,page:1,user:"",pathname:""};if(/\/([a-z]+)\/(\?[^&]+)$/.test(e)){const{$1:e,$2:s}=RegExp,a=s.slice(1);if("user"===e)t.pathname=e,t.type="user",t.user=a;else if("item"===e){const s=parseInt(a,10);s&&0<s&&(t.pathname=e,t.type="item",t.id=s)}else n.includes(e)&&(t.pathname=e,t.type="story",t.page=Math.max(parseInt(a,10)||1,1))}return t}}};