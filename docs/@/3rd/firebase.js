var e,t;!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).firebase=t()}(this,(function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)},t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function i(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=i(e[n],t[n]));return e}var o=(s.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},s);function s(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}var a,h,l,u=(a=Error,e(h=p,l=a),h.prototype=null===l?Object.create(l):(c.prototype=l.prototype,new c),p);function c(){this.constructor=h}function p(e,t){var n=a.call(this,t)||this;return n.code=e,n.name="FirebaseError",Object.setPrototypeOf(n,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,d.prototype.create),n}var d=(f.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r,i=t[0]||{},o=this.service+"/"+e,s=this.errors[e],a=s?(r=i,s.replace(y,(function(e,t){var n=r[t];return null!=n?n.toString():"<"+t+"?>"}))):"Error",h=this.serviceName+": "+a+" ("+o+").",l=new u(o,h),c=0,p=Object.keys(i);c<p.length;c++){var d=p[c];"_"!==d.slice(-1)&&(d in l&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),l[d]=i[d])}return l},f);function f(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var y=/\{\$([^}]+)}/g;function _(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function v(e,t){var n=new g(e,t);return n.subscribe.bind(n)}var g=(m.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},m.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},m.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},m.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"==typeof e&&null!==e)for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return 1}}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=C),void 0===r.error&&(r.error=C),void 0===r.complete&&(r.complete=C);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),o},m.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},m.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},m.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))},m.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},m);function m(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}function C(){}var E=(w.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},w.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},w.prototype.setServiceProps=function(e){return this.serviceProps=e,this},w);function w(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var b="[DEFAULT]",S=(T.prototype.get=function(e){void 0===e&&(e=b);var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new o;this.instancesDeferred.set(t,n);try{var r=this.getOrInitializeService(t);r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise},T.prototype.getImmediate=function(e){var n=t({identifier:b,optional:!1},e),r=n.identifier,i=n.optional,o=this.normalizeInstanceIdentifier(r);try{var s=this.getOrInitializeService(o);if(s)return s;if(i)return null;throw Error("Service "+this.name+" is not available")}catch(e){if(i)return null;throw e}},T.prototype.getComponent=function(){return this.component},T.prototype.setComponent=function(e){var t,i;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if("EAGER"===(this.component=e).instantiationMode)try{this.getOrInitializeService(b)}catch(e){}try{for(var o=n(this.instancesDeferred.entries()),s=o.next();!s.done;s=o.next()){var a=r(s.value,2),h=a[0],l=a[1],u=this.normalizeInstanceIdentifier(h);try{var c=this.getOrInitializeService(u);l.resolve(c)}catch(e){}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},T.prototype.clearInstance=function(e){void 0===e&&(e=b),this.instancesDeferred.delete(e),this.instances.delete(e)},T.prototype.delete=function(){return function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{h(r.next(e))}catch(e){o(e)}}function a(e){try{h(r.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}h((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){var e;return function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))];case 1:return t.sent(),[2]}}))}))},T.prototype.isComponentSet=function(){return null!=this.component},T.prototype.getOrInitializeService=function(e){var t,n=this.instances.get(e);return!n&&this.component&&(n=this.component.instanceFactory(this.container,(t=e)===b?void 0:t),this.instances.set(e,n)),n||null},T.prototype.normalizeInstanceIdentifier=function(e){return!this.component||this.component.multipleInstances?e:b},T);function T(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var I,N=(R.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},R.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},R.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new S(e,this);return this.providers.set(e,t),t},R.prototype.getProviders=function(){return Array.from(this.providers.values())},R);function R(e){this.name=e,this.providers=new Map}function P(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var O,D,x=[];function F(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=M[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,P(["["+i+"]  "+e.name+":"],n))}}(D=O=O||{})[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";var k,A={debug:O.DEBUG,verbose:O.VERBOSE,info:O.INFO,warn:O.WARN,error:O.ERROR,silent:O.SILENT},L=O.INFO,M=((I={})[O.DEBUG]="log",I[O.VERBOSE]="log",I[O.INFO]="info",I[O.WARN]="warn",I[O.ERROR]="error",I),W=(Object.defineProperty(Q.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in O))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!0,configurable:!0}),Q.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,P([this,O.DEBUG],e)),this._logHandler.apply(this,P([this,O.DEBUG],e))},Q.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,P([this,O.VERBOSE],e)),this._logHandler.apply(this,P([this,O.VERBOSE],e))},Q.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,P([this,O.INFO],e)),this._logHandler.apply(this,P([this,O.INFO],e))},Q.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,P([this,O.WARN],e)),this._logHandler.apply(this,P([this,O.WARN],e))},Q.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,P([this,O.ERROR],e)),this._logHandler.apply(this,P([this,O.ERROR],e))},Q);function Q(e){this.name=e,this._logLevel=L,this._logHandler=F,this._userLogHandler=null,x.push(this)}function q(e){var t="string"==typeof e?A[e]:e;x.forEach((function(e){e.logLevel=t}))}var U,H=((k={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",k["bad-app-name"]="Illegal App name: '{$appName}",k["duplicate-app"]="Firebase App named '{$appName}' already exists",k["app-deleted"]="Firebase App named '{$appName}' already deleted",k["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",k["invalid-log-argument"]="First argument to `onLog` must be null or a function.",k),V=new d("app","Firebase",H),j="@firebase/app",B="[DEFAULT]",z=((U={})[j]="fire-core",U["@firebase/analytics"]="fire-analytics",U["@firebase/auth"]="fire-auth",U["@firebase/database"]="fire-rtdb",U["@firebase/functions"]="fire-fn",U["@firebase/installations"]="fire-iid",U["@firebase/messaging"]="fire-fcm",U["@firebase/performance"]="fire-perf",U["@firebase/remote-config"]="fire-rc",U["@firebase/storage"]="fire-gcs",U["@firebase/firestore"]="fire-fst",U["fire-js"]="fire-js",U["firebase-wrapper"]="fire-js-all",U),Y=new W("@firebase/app"),K=(Object.defineProperty(G.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),G.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},G.prototype._getService=function(e,t){return void 0===t&&(t=B),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:t})},G.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=B),this.container.getProvider(e).clearInstance(t)},G.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){Y.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},G.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},G.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw V.create("app-deleted",{appName:this.name_})},G);function G(e,t,r){var o,s,a=this;this.firebase_=r,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=i(void 0,e),this.container=new N(t.name),this._addComponent(new E("app",(function(){return a}),"PUBLIC"));try{for(var h=n(this.firebase_.INTERNAL.components.values()),l=h.next();!l.done;l=h.next()){var u=l.value;this._addComponent(u)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}}K.prototype.name&&K.prototype.options||K.prototype.delete||console.log("dc");var X=function e(){var r=function(e){var t={},r=new Map,o={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),"object"==typeof r&&null!==r||(r={name:r});var i=r;void 0===i.name&&(i.name=B);var s=i.name;if("string"!=typeof s||!s)throw V.create("bad-app-name",{appName:String(s)});if(_(t,s))throw V.create("duplicate-app",{appName:s});var a=new e(n,i,o);return t[s]=a},app:s,registerVersion:function(e,t,n){var r,i=null!==(r=z[e])&&void 0!==r?r:e;n&&(i+="-"+n);var o=i.match(/\s|\//),s=t.match(/\s|\//);if(o||s){var h=['Unable to register library "'+i+'" with version "'+t+'":'];return o&&h.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&s&&h.push("and"),s&&h.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void Y.warn(h.join(" "))}a(new E(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:q,onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw V.create("invalid-log-argument",{appName:name});!function(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=A[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((function(e){return e})).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:O[n].toLowerCase(),message:s,args:i,type:t.name})}},r=0,i=x;r<i.length;r++)n(i[r])}(e,t)},apps:null,SDK_VERSION:"7.14.6",INTERNAL:{registerComponent:a,removeApp:function(e){delete t[e]},components:r,useAsService:function(e,t){return"serverAuth"!==t?t:null}}};function s(e){if(!_(t,e=e||B))throw V.create("no-app",{appName:e});return t[e]}function a(a){var h,l,u=a.name;if(r.has(u))return Y.debug("There were multiple attempts to register component "+u+"."),"PUBLIC"===a.type?o[u]:null;if(r.set(u,a),"PUBLIC"===a.type){var c=function(e){if(void 0===e&&(e=s()),"function"!=typeof e[u])throw V.create("invalid-app-argument",{appName:u});return e[u]()};void 0!==a.serviceProps&&i(c,a.serviceProps),o[u]=c,e.prototype[u]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,u).apply(this,a.multipleInstances?e:[])}}try{for(var p=n(Object.keys(t)),d=p.next();!d.done;d=p.next()){var f=d.value;t[f]._addComponent(a)}}catch(l){h={error:l}}finally{try{d&&!d.done&&(l=p.return)&&l.call(p)}finally{if(h)throw h.error}}return"PUBLIC"===a.type?o[u]:null}return o.default=o,Object.defineProperty(o,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),s.App=e,o}(K);return r.INTERNAL=t(t({},r.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){i(r,e)},createSubscribe:v,ErrorFactory:d,deepExtend:i}),r}(),$=(J.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,n=e.getImmediate();return n.library+"/"+n.version})).filter((function(e){return e})).join(" ")},J);function J(e){this.container=e}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Y.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var Z=self.firebase.SDK_VERSION;Z&&0<=Z.indexOf("LITE")&&Y.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ee=X.initializeApp;X.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&Y.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),ee.apply(void 0,e)};var te,ne=X;return(te=ne).INTERNAL.registerComponent(new E("platform-logger",(function(e){return new $(e)}),"PRIVATE")),te.registerVersion(j,"0.6.4",void 0),te.registerVersion("fire-js",""),ne.registerVersion("firebase","7.14.6","app"),ne})),e=this,t=function(e){try{(function(){e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,n)};function n(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e}function a(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function h(e){try{return d.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}var l=!1,u="${JSCORE_VERSION}",c=function(e,t){if(!e)throw p(t)},p=function(e){return new Error("Firebase Database ("+u+") INTERNAL ASSERT FAILED: "+e)},d={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,h=i+2<e.length,l=h?e[i+2]:0,u=o>>2,c=(3&o)<<4|a>>4,p=(15&a)<<2|l>>6,d=63&l;h||(d=64,s||(p=64)),r.push(n[u],n[c],n[p],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var s=((7&i)<<18|(63&(o=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{o=e[n++];var a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,h=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==h)throw Error();var l=o<<2|s>>4;if(r.push(l),64!==a){var u=s<<4&240|a>>2;if(r.push(u),64!==h){var c=a<<6&192|h;r.push(c)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},f=(y.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},y);function y(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}function _(){return"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function v(){return!0===l}var g,m=(n(C,g=Error),C);function C(e,t){var n=g.call(this,t)||this;return n.code=e,n.name="FirebaseError",Object.setPrototypeOf(n,C.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,E.prototype.create),n}var E=(w.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r,i=t[0]||{},o=this.service+"/"+e,s=this.errors[e],a=s?(r=i,s.replace(b,(function(e,t){var n=r[t];return null!=n?n.toString():"<"+t+"?>"}))):"Error",h=this.serviceName+": "+a+" ("+o+").",l=new m(o,h),u=0,c=Object.keys(i);u<c.length;u++){var p=c[u];"_"!==p.slice(-1)&&(p in l&&console.warn('Overwriting FirebaseError base field "'+p+'" can cause unexpected behavior.'),l[p]=i[p])}return l},w);function w(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var b=/\{\$([^}]+)}/g;function S(e){return JSON.parse(e)}function T(e){return JSON.stringify(e)}function I(e){var t={},n={},r={},i="";try{var o=e.split(".");t=S(h(o[0])||""),n=S(h(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function P(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function O(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}var D,x,F,k=(A.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},A.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],h=this.chain_[1],l=this.chain_[2],u=this.chain_[3],c=this.chain_[4];for(r=0;r<80;r++)s=r<40?r<20?(o=u^h&(l^u),1518500249):(o=h^l^u,1859775393):r<60?(o=h&l|u&(h|l),2400959708):(o=h^l^u,3395469782),i=(a<<5|a>>>27)+o+c+s+n[r]&4294967295,c=u,u=l,l=4294967295&(h<<30|h>>>2),h=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+h&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295},A.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},A.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},A);function A(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}function L(e,t,n,r){var i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function M(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return e+" failed: "+r+" argument "}function W(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(M(e,t,r)+"must be a valid function.")}function Q(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(M(e,t,r)+"must be a valid context object.")}function q(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t}function U(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function H(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=j[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,U(["["+i+"]  "+e.name+":"],n))}}(F=x=x||{})[F.DEBUG=0]="DEBUG",F[F.VERBOSE=1]="VERBOSE",F[F.INFO=2]="INFO",F[F.WARN=3]="WARN",F[F.ERROR=4]="ERROR",F[F.SILENT=5]="SILENT",x.DEBUG,x.VERBOSE,x.INFO,x.WARN,x.ERROR,x.SILENT;var V=x.INFO,j=((D={})[x.DEBUG]="log",D[x.VERBOSE]="log",D[x.INFO]="info",D[x.WARN]="warn",D[x.ERROR]="error",D),B=(Object.defineProperty(z.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in x))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!0,configurable:!0}),z.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,U([this,x.DEBUG],e)),this._logHandler.apply(this,U([this,x.DEBUG],e))},z.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,U([this,x.VERBOSE],e)),this._logHandler.apply(this,U([this,x.VERBOSE],e))},z.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,U([this,x.INFO],e)),this._logHandler.apply(this,U([this,x.INFO],e))},z.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,U([this,x.WARN],e)),this._logHandler.apply(this,U([this,x.WARN],e))},z.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,U([this,x.ERROR],e)),this._logHandler.apply(this,U([this,x.ERROR],e))},z);function z(e){this.name=e,this._logLevel=V,this._logHandler=H,this._userLogHandler=null}var Y=(K.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},K.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},K.prototype.setServiceProps=function(e){return this.serviceProps=e,this},K);function K(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var G=(X.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),T(t))},X.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:S(t)},X.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},X.prototype.prefixedName_=function(e){return this.prefix_+e},X.prototype.toString=function(){return this.domStorage_.toString()},X);function X(e){this.domStorage_=e,this.prefix_="firebase:"}var $=(J.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},J.prototype.get=function(e){return N(this.cache_,e)?this.cache_[e]:null},J.prototype.remove=function(e){delete this.cache_[e]},J);function J(){this.cache_={},this.isInMemoryStorage=!0}function Z(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new G(t)}}catch(e){}return new $}function ee(e){var t=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;c(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}(e),n=new k;n.update(t);var r=n.digest();return d.encodeByteArray(r)}function te(e,t){c(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(fe.logLevel=x.VERBOSE,ve=fe.log.bind(fe),t&&de.set("logging_enabled",!0)):"function"==typeof e?ve=e:(ve=null,de.remove("logging_enabled"))}function ne(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===ge&&(ge=!1,null===ve&&!0===de.get("logging_enabled")&&te(!0)),ve){var n=_e.apply(null,e);ve(n)}}function re(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];ne.apply(void 0,s([e],t))}}function ie(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+_e.apply(void 0,s(e));fe.error(n)}function oe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+_e.apply(void 0,s(e));throw fe.error(n),new Error(n)}function se(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+_e.apply(void 0,s(e));fe.warn(n)}function ae(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)}function he(e,t){return e===t?0:e<t?-1:1}function le(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+T(t))}function ue(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)n<i+t?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}var ce,pe=Z("localStorage"),de=Z("sessionStorage"),fe=new B("@firebase/database"),ye=(ce=1,function(){return ce++}),_e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=_e.apply(null,i):n+="object"==typeof i?T(i):i,n+=" "}return n},ve=null,ge=!0,me="[MIN_NAME]",Ce="[MAX_NAME]",Ee=function(e,t){if(e===t)return 0;if(e===me||t===Ce)return-1;if(t===me||e===Ce)return 1;var n=Re(e),r=Re(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1},we=function(e){if("object"!=typeof e||null===e)return T(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=T(t[i]),r+=":",r+=we(e[t[i]]);return r+"}"};function be(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Se(e){var t,n,r,i,o;c(!ae(e),"Invalid JSON number"),0===e?t=1/e==-1/(r=n=0)?1:0:(t=e<0,r=(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));var s=[];for(o=52;o;--o)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;--o)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var a=s.join(""),h="";for(o=0;o<64;o+=8){var l=parseInt(a.substr(o,8),2).toString(16);1===l.length&&(l="0"+l),h+=l}return h.toLowerCase()}function Te(e){try{e()}catch(e){setTimeout((function(){throw se("Exception was thrown by user callback.",e.stack||""),e}),Math.floor(0))}}function Ie(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n}var Ne=new RegExp("^-?(0*)\\d{1,10}$"),Re=function(e){if(Ne.test(e)){var t=Number(e);if(-2147483648<=t&&t<=2147483647)return t}return null},Pe=(Object.defineProperty(Oe,"Empty",{get:function(){return new Oe("")},enumerable:!0,configurable:!0}),Oe.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Oe.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Oe.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new Oe(this.pieces_,e)},Oe.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Oe.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},Oe.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},Oe.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},Oe.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],t=this.pieceNum_;t<this.pieces_.length-1;t++)e.push(this.pieces_[t]);return new Oe(e,0)},Oe.prototype.child=function(e){for(var t=[],n=this.pieceNum_;n<this.pieces_.length;n++)t.push(this.pieces_[n]);if(e instanceof Oe)for(n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{var r=e.split("/");for(n=0;n<r.length;n++)0<r[n].length&&t.push(r[n])}return new Oe(t,0)},Oe.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Oe.relativePath=function(e,t){var n=e.getFront(),r=t.getFront();if(null===n)return t;if(n===r)return Oe.relativePath(e.popFront(),t.popFront());throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")},Oe.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var o=Ee(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Oe.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},Oe.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},Oe);function Oe(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}var De=(Object.defineProperty(xe,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(xe,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),xe.prototype.push=function(e){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=q(e),this.checkValid_()},xe.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=q(e),0<this.parts_.length&&--this.byteLength_},xe.prototype.checkValid_=function(){if(this.byteLength_>xe.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+xe.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>xe.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xe.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},xe.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},xe);function xe(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=q(this.parts_[n]);this.checkValid_()}var Fe="firebaseio.com",ke="websocket",Ae="long_polling",Le=(Me.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},Me.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},Me.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},Me.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},Me.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&pe.set("host:"+this.host,this.internalHost))},Me.prototype.connectionURL=function(e,t){var n;if(c("string"==typeof e,"typeof type must == string"),c("object"==typeof t,"typeof params must == object"),e===ke)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==Ae)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return be(t,(function(e,t){r.push(e+"="+t)})),n+r.join("&")},Me.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},Me.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},Me);function Me(e,t,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=pe.get("host:"+e)||this.host}function We(e){var t=Xe(e),n=t.namespace;"firebase.com"===t.domain&&oe(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===t.domain||oe("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&se("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===t.scheme||"wss"===t.scheme;return{repoInfo:new Le(t.host,t.secure,n,r,"",n!==t.subdomain),path:new Pe(t.pathString)}}function Qe(e){return"string"==typeof e&&0!==e.length&&!$e.test(e)}function qe(e){return"string"==typeof e&&0!==e.length&&!Je.test(e)}function Ue(e){return null===e||"string"==typeof e||"number"==typeof e&&!ae(e)||e&&"object"==typeof e&&N(e,".sv")}function He(e,t,n,r,i){i&&void 0===n||et(M(e,t,i),n,r)}function Ve(e,t,n,r,i){if(!i||void 0!==n){var o=M(e,t,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];be(n,(function(e,t){var n=new Pe(e);if(et(o,t,r.child(n)),".priority"===n.getBack()&&!Ue(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),o=0;o<i.length;o++)if((".priority"!==i[o]||o!==i.length-1)&&!Qe(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(Pe.comparePaths);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&s.contains(r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(o,s)}}function je(e,t,n,r){if(!r||void 0!==n){if(ae(n))throw new Error(M(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ue(n))throw new Error(M(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function Be(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(M(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function ze(e,t,n,r){if(!(r&&void 0===n||Qe(n)))throw new Error(M(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Ye(e,t,n,r){if(!(r&&void 0===n||qe(n)))throw new Error(M(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function Ke(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")}function Ge(e,t,n){var r,i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Qe(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&!qe(r=(r=i)&&r.replace(/^\/*\.info(\/|$)/,"/")))throw new Error(M(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var Xe=function(e){var t="",n="",r="",o="",s="",a=!0,h="https",l=443;if("string"==typeof e){var u=e.indexOf("//");0<=u&&(h=e.substring(0,u-1),e=e.substring(u+2));var c=e.indexOf("/");-1===c&&(c=e.length);var p=e.indexOf("?");-1===p&&(p=e.length),t=e.substring(0,Math.min(c,p)),c<p&&(o=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(c,p)));var d=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=i(e.split("&")),s=o.next();!s.done;s=o.next()){var a=s.value;if(0!==a.length){var h=a.split("=");2===h.length?r[decodeURIComponent(h[0])]=decodeURIComponent(h[1]):se("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,p)));0<=(u=t.indexOf(":"))?(a="https"===h||"wss"===h,l=parseInt(t.substring(u+1),10)):u=t.length;var f=t.slice(0,u);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{var y=t.indexOf(".");r=t.substring(0,y).toLowerCase(),n=t.substring(y+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:a,scheme:h,pathString:o,namespace:s}},$e=/[\[\].#$\/\u0000-\u001F\u007F]/,Je=/[\[\].#$\u0000-\u001F\u007F]/,Ze=10485760,et=function(e,t,n){var r=n instanceof Pe?new De(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(ae(t))throw new Error(e+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>Ze/3&&q(t)>Ze)throw new Error(e+"contains a string greater than "+Ze+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(be(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!Qe(t)))throw new Error(e+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),et(e,n,r),r.pop()})),i&&o)throw new Error(e+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},tt=(nt.prototype.cancel=function(e){L("OnDisconnect.cancel",0,1,arguments.length),W("OnDisconnect.cancel",1,e,!0);var t=new f;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},nt.prototype.remove=function(e){L("OnDisconnect.remove",0,1,arguments.length),Ke("OnDisconnect.remove",this.path_),W("OnDisconnect.remove",1,e,!0);var t=new f;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},nt.prototype.set=function(e,t){L("OnDisconnect.set",1,2,arguments.length),Ke("OnDisconnect.set",this.path_),He("OnDisconnect.set",1,e,this.path_,!1),W("OnDisconnect.set",2,t,!0);var n=new f;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},nt.prototype.setWithPriority=function(e,t,n){L("OnDisconnect.setWithPriority",2,3,arguments.length),Ke("OnDisconnect.setWithPriority",this.path_),He("OnDisconnect.setWithPriority",1,e,this.path_,!1),je("OnDisconnect.setWithPriority",2,t,!1),W("OnDisconnect.setWithPriority",3,n,!0);var r=new f;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},nt.prototype.update=function(e,t){if(L("OnDisconnect.update",1,2,arguments.length),Ke("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,se("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ve("OnDisconnect.update",1,e,this.path_,!1),W("OnDisconnect.update",2,t,!0);var i=new f;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},nt);function nt(e,t){this.repo_=e,this.path_=t}var rt=(it.prototype.toJSON=function(){return L("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},it);function it(e,t){this.committed=e,this.snapshot=t}var ot,st,at,ht=(ot="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",st=0,at=[],function(e){var t,n=e===st;st=e;var r=new Array(8);for(t=7;0<=t;t--)r[t]=ot.charAt(e%64),e=Math.floor(e/64);c(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;0<=t&&63===at[t];t--)at[t]=0;at[t]++}else for(t=0;t<12;t++)at[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=ot.charAt(at[t]);return c(20===i.length,"nextPushId: Length should be 20."),i}),lt=(ut.Wrap=function(e,t){return new ut(e,t)},ut);function ut(e,t){this.name=e,this.node=t}var ct,pt=(dt.prototype.getCompare=function(){return this.compare.bind(this)},dt.prototype.indexedValueChanged=function(e,t){var n=new lt(me,e),r=new lt(me,t);return 0!==this.compare(n,r)},dt.prototype.minPost=function(){return lt.MIN},dt);function dt(){}var ft,yt=(n(_t,ft=pt),Object.defineProperty(_t,"__EMPTY_NODE",{get:function(){return ct},set:function(e){ct=e},enumerable:!0,configurable:!0}),_t.prototype.compare=function(e,t){return Ee(e.name,t.name)},_t.prototype.isDefinedOn=function(e){throw p("KeyIndex.isDefinedOn not expected to be called.")},_t.prototype.indexedValueChanged=function(e,t){return!1},_t.prototype.minPost=function(){return lt.MIN},_t.prototype.maxPost=function(){return new lt(Ce,ct)},_t.prototype.makePost=function(e,t){return c("string"==typeof e,"KeyIndex indexValue must always be a string."),new lt(e,ct)},_t.prototype.toString=function(){return".key"},_t);function _t(){return null!==ft&&ft.apply(this,arguments)||this}var vt,gt=new yt;function mt(e){return"number"==typeof e?"number:"+Se(e):"string:"+e}function Ct(e){if(e.isLeafNode()){var t=e.val();c("string"==typeof t||"number"==typeof t||"object"==typeof t&&N(t,".sv"),"Priority must be a string or number.")}else c(e===vt||e.isEmpty(),"priority of unexpected type.");c(e===vt||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Et,wt,bt,St,Tt=(Object.defineProperty(It,"__childrenNodeConstructor",{get:function(){return Et},set:function(e){Et=e},enumerable:!0,configurable:!0}),It.prototype.isLeafNode=function(){return!0},It.prototype.getPriority=function(){return this.priorityNode_},It.prototype.updatePriority=function(e){return new It(this.value_,e)},It.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:It.__childrenNodeConstructor.EMPTY_NODE},It.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:It.__childrenNodeConstructor.EMPTY_NODE},It.prototype.hasChild=function(){return!1},It.prototype.getPredecessorChildName=function(e,t){return null},It.prototype.updateImmediateChild=function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:It.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},It.prototype.updateChild=function(e,t){var n=e.getFront();return null===n?t:t.isEmpty()&&".priority"!==n?this:(c(".priority"!==n||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,It.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),t)))},It.prototype.isEmpty=function(){return!1},It.prototype.numChildren=function(){return 0},It.prototype.forEachChild=function(e,t){return!1},It.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},It.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+mt(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Se(this.value_):this.value_,this.lazyHash_=ee(e)}return this.lazyHash_},It.prototype.getValue=function(){return this.value_},It.prototype.compareTo=function(e){return e===It.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof It.__childrenNodeConstructor?-1:(c(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},It.prototype.compareToLeafNode_=function(e){var t=typeof e.value_,n=typeof this.value_,r=It.VALUE_TYPE_ORDER.indexOf(t),i=It.VALUE_TYPE_ORDER.indexOf(n);return c(0<=r,"Unknown leaf type: "+t),c(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r},It.prototype.withIndex=function(){return this},It.prototype.isIndexed=function(){return!0},It.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)},It.VALUE_TYPE_ORDER=["object","boolean","number","string"],It);function It(e,t){void 0===t&&(t=It.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=t,this.lazyHash_=null,c(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ct(this.priorityNode_)}function Nt(){return null!==St&&St.apply(this,arguments)||this}var Rt=new(n(Nt,St=pt),Nt.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Ee(e.name,t.name):i},Nt.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},Nt.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},Nt.prototype.minPost=function(){return lt.MIN},Nt.prototype.maxPost=function(){return new lt(Ce,new Tt("[PRIORITY-POST]",bt))},Nt.prototype.makePost=function(e,t){var n=wt(e);return new lt(t,new Tt("[PRIORITY-POST]",n))},Nt.prototype.toString=function(){return".priority"},Nt),Pt=(Ot.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},Ot.prototype.hasNext=function(){return 0<this.nodeStack_.length},Ot.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},Ot);function Ot(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}var Dt=(xt.prototype.copy=function(e,t,n,r,i){return new xt(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},xt.prototype.count=function(){return this.left.count()+1+this.right.count()},xt.prototype.isEmpty=function(){return!1},xt.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},xt.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},xt.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},xt.prototype.minKey=function(){return this.min_().key},xt.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},xt.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},xt.prototype.removeMin_=function(){if(this.left.isEmpty())return At.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},xt.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return At.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},xt.prototype.isRed_=function(){return this.color},xt.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},xt.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},xt.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},xt.prototype.rotateLeft_=function(){var e=this.copy(null,null,xt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},xt.prototype.rotateRight_=function(){var e=this.copy(null,null,xt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},xt.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},xt.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},xt.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},xt.RED=!0,xt.BLACK=!1,xt);function xt(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:xt.RED,this.left=null!=r?r:At.EMPTY_NODE,this.right=null!=i?i:At.EMPTY_NODE}var Ft=(kt.prototype.copy=function(e,t,n,r,i){return this},kt.prototype.insert=function(e,t,n){return new Dt(e,t,null)},kt.prototype.remove=function(e,t){return this},kt.prototype.count=function(){return 0},kt.prototype.isEmpty=function(){return!0},kt.prototype.inorderTraversal=function(e){return!1},kt.prototype.reverseTraversal=function(e){return!1},kt.prototype.minKey=function(){return null},kt.prototype.maxKey=function(){return null},kt.prototype.check_=function(){return 0},kt.prototype.isRed_=function(){return!1},kt);function kt(){}var At=(Lt.prototype.insert=function(e,t){return new Lt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Dt.BLACK,null,null))},Lt.prototype.remove=function(e){return new Lt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Dt.BLACK,null,null))},Lt.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null},Lt.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},Lt.prototype.isEmpty=function(){return this.root_.isEmpty()},Lt.prototype.count=function(){return this.root_.count()},Lt.prototype.minKey=function(){return this.root_.minKey()},Lt.prototype.maxKey=function(){return this.root_.maxKey()},Lt.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},Lt.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},Lt.prototype.getIterator=function(e){return new Pt(this.root_,null,this.comparator_,!1,e)},Lt.prototype.getIteratorFrom=function(e,t){return new Pt(this.root_,e,this.comparator_,!1,t)},Lt.prototype.getReverseIteratorFrom=function(e,t){return new Pt(this.root_,e,this.comparator_,!0,t)},Lt.prototype.getReverseIterator=function(e){return new Pt(this.root_,null,this.comparator_,!0,e)},Lt.EMPTY_NODE=new Ft,Lt);function Lt(e,t){void 0===t&&(t=Lt.EMPTY_NODE),this.comparator_=e,this.root_=t}var Mt=Math.log(2),Wt=(Qt.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},Qt);function Qt(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Mt,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}var qt,Ut,Ht=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0==a)return null;if(1==a)return o=e[t],s=n?n(o):o,new Dt(s,o.node,Dt.BLACK,null,null);var h=parseInt(a/2,10)+t,l=i(t,h),u=i(h+1,r);return o=e[h],s=n?n(o):o,new Dt(s,o.node,Dt.BLACK,l,u)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var l=i(1+o,a),u=e[o],c=n?n(u):u;h(new Dt(c,u.node,r,null,l))},h=function(e){r=r?r.left=e:o=e},l=0;l<t.count;++l){var u=t.nextBitIsOne(),c=Math.pow(2,t.count-(l+1));u?a(c,Dt.BLACK):(a(c,Dt.BLACK),a(c,Dt.RED))}return o}(new Wt(e.length));return new At(r||t,o)},Vt={},jt=(Object.defineProperty(Bt,"Default",{get:function(){return c(Rt,"ChildrenNode.ts has not been loaded"),qt=qt||new Bt({".priority":Vt},{".priority":Rt})},enumerable:!0,configurable:!0}),Bt.prototype.get=function(e){var t=R(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof At?t:null},Bt.prototype.hasIndex=function(e){return N(this.indexSet_,e.toString())},Bt.prototype.addIndex=function(e,t){c(e!==gt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,i=[],o=!1,s=t.getIterator(lt.Wrap),a=s.getNext();a;)o=o||e.isDefinedOn(a.node),i.push(a),a=s.getNext();n=o?Ht(i,e.getCompare()):Vt;var h=e.toString(),l=r({},this.indexSet_);l[h]=e;var u=r({},this.indexes_);return u[h]=n,new Bt(u,l)},Bt.prototype.addToIndexes=function(e,t){var n=this;return new Bt(O(this.indexes_,(function(r,i){var o=R(n.indexSet_,i);if(c(o,"Missing index implementation for "+i),r===Vt){if(o.isDefinedOn(e.node)){for(var s=[],a=t.getIterator(lt.Wrap),h=a.getNext();h;)h.name!==e.name&&s.push(h),h=a.getNext();return s.push(e),Ht(s,o.getCompare())}return Vt}var l=t.get(e.name),u=r;return l&&(u=u.remove(new lt(e.name,l))),u.insert(e,e.node)})),this.indexSet_)},Bt.prototype.removeFromIndexes=function(e,t){return new Bt(O(this.indexes_,(function(n){if(n===Vt)return n;var r=t.get(e.name);return r?n.remove(new lt(e.name,r)):n})),this.indexSet_)},Bt);function Bt(e,t){this.indexes_=e,this.indexSet_=t}function zt(e,t){return Ee(e.name,t.name)}function Yt(e,t){return Ee(e,t)}var Kt,Gt=(Object.defineProperty(Xt,"EMPTY_NODE",{get:function(){return Ut=Ut||new Xt(new At(Yt),null,jt.Default)},enumerable:!0,configurable:!0}),Xt.prototype.isLeafNode=function(){return!1},Xt.prototype.getPriority=function(){return this.priorityNode_||Ut},Xt.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new Xt(this.children_,e,this.indexMap_)},Xt.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ut:t},Xt.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},Xt.prototype.hasChild=function(e){return null!==this.children_.get(e)},Xt.prototype.updateImmediateChild=function(e,t){if(c(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var n,r=new lt(e,t),i=void 0;n=t.isEmpty()?(i=this.children_.remove(e),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),this.indexMap_.addToIndexes(r,this.children_));var o=i.isEmpty()?Ut:this.priorityNode_;return new Xt(i,o,n)},Xt.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;c(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,r)},Xt.prototype.isEmpty=function(){return this.children_.isEmpty()},Xt.prototype.numChildren=function(){return this.children_.count()},Xt.prototype.val=function(e){if(this.isEmpty())return null;var t={},n=0,r=0,i=!0;if(this.forEachChild(Rt,(function(o,s){t[o]=s.val(e),n++,i&&Xt.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!e&&i&&r<2*n){var o=[];for(var s in t)o[s]=t[s];return o}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},Xt.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+mt(this.getPriority().val())+":"),this.forEachChild(Rt,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":ee(e)}return this.lazyHash_},Xt.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new lt(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},Xt.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},Xt.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new lt(t,this.children_.get(t)):null},Xt.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},Xt.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new lt(t,this.children_.get(t)):null},Xt.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},Xt.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},Xt.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,lt.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},Xt.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},Xt.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,lt.Wrap),i=r.peek();null!=i&&0<t.compare(i,e);)r.getNext(),i=r.peek();return r},Xt.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Zt?-1:0},Xt.prototype.withIndex=function(e){if(e===gt||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new Xt(this.children_,this.priorityNode_,t)},Xt.prototype.isIndexed=function(e){return e===gt||this.indexMap_.hasIndex(e)},Xt.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()!==t.children_.count())return!1;for(var n=this.getIterator(Rt),r=t.getIterator(Rt),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},Xt.prototype.resolveIndex_=function(e){return e===gt?null:this.indexMap_.get(e.toString())},Xt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,Xt);function Xt(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ct(this.priorityNode_),this.children_.isEmpty()&&c(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function $t(){return Kt.call(this,new At(Yt),Gt.EMPTY_NODE,jt.Default)||this}var Jt,Zt=new(n($t,Kt=Gt),$t.prototype.compareTo=function(e){return e===this?0:1},$t.prototype.equals=function(e){return e===this},$t.prototype.getPriority=function(){return this},$t.prototype.getImmediateChild=function(e){return Gt.EMPTY_NODE},$t.prototype.isEmpty=function(){return!1},$t);function en(e,t){if(void 0===t&&(t=null),null===e)return Gt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),c(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Tt(e,en(t));if(e instanceof Array){var n=Gt.EMPTY_NODE;return be(e,(function(t,r){if(N(e,t)&&"."!==t.substring(0,1)){var i=en(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(en(t))}var r=[],i=!1;if(be(e,(function(e,t){if("."!==e.substring(0,1)){var n=en(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new lt(e,n)))}})),0===r.length)return Gt.EMPTY_NODE;var o=Ht(r,zt,(function(e){return e.name}),Yt);if(i){var s=Ht(r,Rt.getCompare());return new Gt(o,en(t),new jt({".priority":s},{".priority":Rt}))}return new Gt(o,en(t),jt.Default)}function tn(){return null!==Jt&&Jt.apply(this,arguments)||this}Object.defineProperties(lt,{MIN:{value:new lt(me,Gt.EMPTY_NODE)},MAX:{value:new lt(Ce,Zt)}}),yt.__EMPTY_NODE=Gt.EMPTY_NODE,Tt.__childrenNodeConstructor=Gt,vt=Zt,bt=Zt,wt=en;var nn,rn=new(n(tn,Jt=pt),tn.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?Ee(e.name,t.name):n},tn.prototype.isDefinedOn=function(e){return!0},tn.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},tn.prototype.minPost=function(){return lt.MIN},tn.prototype.maxPost=function(){return lt.MAX},tn.prototype.makePost=function(e,t){var n=en(e);return new lt(t,n)},tn.prototype.toString=function(){return".value"},tn),on=(n(sn,nn=pt),sn.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},sn.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},sn.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Ee(e.name,t.name):i},sn.prototype.makePost=function(e,t){var n=en(e),r=Gt.EMPTY_NODE.updateChild(this.indexPath_,n);return new lt(t,r)},sn.prototype.maxPost=function(){var e=Gt.EMPTY_NODE.updateChild(this.indexPath_,Zt);return new lt(Ce,e)},sn.prototype.toString=function(){return this.indexPath_.slice().join("/")},sn);function sn(e){var t=nn.call(this)||this;return t.indexPath_=e,c(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),t}var an=(hn.prototype.val=function(){return L("DataSnapshot.val",0,0,arguments.length),this.node_.val()},hn.prototype.exportVal=function(){return L("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},hn.prototype.toJSON=function(){return L("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},hn.prototype.exists=function(){return L("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},hn.prototype.child=function(e){L("DataSnapshot.child",0,1,arguments.length),Ye("DataSnapshot.child",1,e=String(e),!1);var t=new Pe(e),n=this.ref_.child(t);return new hn(this.node_.getChild(t),n,Rt)},hn.prototype.hasChild=function(e){L("DataSnapshot.hasChild",1,1,arguments.length),Ye("DataSnapshot.hasChild",1,e,!1);var t=new Pe(e);return!this.node_.getChild(t).isEmpty()},hn.prototype.getPriority=function(){return L("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},hn.prototype.forEach=function(e){var t=this;return L("DataSnapshot.forEach",1,1,arguments.length),W("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,(function(n,r){return e(new hn(r,t.ref_.child(n),Rt))}))},hn.prototype.hasChildren=function(){return L("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(hn.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),hn.prototype.numChildren=function(){return L("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},hn.prototype.getRef=function(){return L("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(hn.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),hn);function hn(e,t,n){this.node_=e,this.ref_=t,this.index_=n}var ln=(un.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},un.prototype.getEventType=function(){return this.eventType},un.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},un.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+T(this.snapshot.exportVal())},un);function un(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}var cn=(pn.prototype.getPath=function(){return this.path},pn.prototype.getEventType=function(){return"cancel"},pn.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},pn.prototype.toString=function(){return this.path.toString()+":cancel"},pn);function pn(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}var dn=(fn.prototype.respondsTo=function(e){return"value"===e},fn.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new ln("value",this,new an(e.snapshotNode,t.getRef(),n))},fn.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){c(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},fn.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new cn(this,e,t):null},fn.prototype.matches=function(e){return e instanceof fn&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},fn.prototype.hasAnyCallback=function(){return null!==this.callback_},fn);function fn(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}var yn,_n=(vn.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,N(this.callbacks_,t)},vn.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new cn(this,e,t):null},vn.prototype.createEvent=function(e,t){c(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new ln(e.type,this,new an(e.snapshotNode,n,r),e.prevName)},vn.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){c(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},vn.prototype.matches=function(e){var t=this;if(e instanceof vn){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=n.length;if(i===r.length){if(1!==i)return r.every((function(n){return e.callbacks_[n]===t.callbacks_[n]}));var o=n[0],s=r[0];return!(s!==o||e.callbacks_[o]&&this.callbacks_[s]&&e.callbacks_[o]!==this.callbacks_[s])}}}return!1},vn.prototype.hasAnyCallback=function(){return null!==this.callbacks_},vn);function vn(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}var gn=(Object.defineProperty(mn,"__referenceConstructor",{get:function(){return c(yn,"Reference.ts has not been loaded"),yn},set:function(e){yn=e},enumerable:!0,configurable:!0}),mn.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===gt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==me)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Ce)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Rt){if(null!=t&&!Ue(t)||null!=n&&!Ue(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(c(e.getIndex()instanceof on||e.getIndex()===rn,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},mn.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},mn.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},mn.prototype.getQueryParams=function(){return this.queryParams_},mn.prototype.getRef=function(){return L("Query.ref",0,0,arguments.length),new mn.__referenceConstructor(this.repo,this.path)},mn.prototype.on=function(e,t,n,r){L("Query.on",2,4,arguments.length),Be("Query.on",1,e,!1),W("Query.on",2,t,!1);var i=mn.getCancelAndContextArgs_("Query.on",n,r);if("value"===e)this.onValueEvent(t,i.cancel,i.context);else{var o={};o[e]=t,this.onChildEvent(o,i.cancel,i.context)}return t},mn.prototype.onValueEvent=function(e,t,n){var r=new dn(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},mn.prototype.onChildEvent=function(e,t,n){var r=new _n(e,t,n);this.repo.addEventCallbackForQuery(this,r)},mn.prototype.off=function(e,t,n){L("Query.off",0,3,arguments.length),Be("Query.off",1,e,!0),W("Query.off",2,t,!0),Q("Query.off",3,n,!0);var r=null,i=null;"value"===e?r=new dn(t||null,null,n||null):e&&(t&&((i={})[e]=t),r=new _n(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},mn.prototype.once=function(e,t,n,r){var i=this;L("Query.once",1,4,arguments.length),Be("Query.once",1,e,!1),W("Query.once",2,t,!0);var o=mn.getCancelAndContextArgs_("Query.once",n,r),s=!0,a=new f;a.promise.catch((function(){}));var h=function(n){s&&(s=!1,i.off(e,h),t&&t.bind(o.context)(n),a.resolve(n))};return this.on(e,h,(function(t){i.off(e,h),o.cancel&&o.cancel.bind(o.context)(t),a.reject(t)})),a.promise},mn.prototype.limitToFirst=function(e){if(L("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new mn(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},mn.prototype.limitToLast=function(e){if(L("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new mn(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},mn.prototype.orderByChild=function(e){if(L("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Ye("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var t=new Pe(e);if(t.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new on(t),r=this.queryParams_.orderBy(n);return mn.validateQueryEndpoints_(r),new mn(this.repo,this.path,r,!0)},mn.prototype.orderByKey=function(){L("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(gt);return mn.validateQueryEndpoints_(e),new mn(this.repo,this.path,e,!0)},mn.prototype.orderByPriority=function(){L("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(Rt);return mn.validateQueryEndpoints_(e),new mn(this.repo,this.path,e,!0)},mn.prototype.orderByValue=function(){L("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(rn);return mn.validateQueryEndpoints_(e),new mn(this.repo,this.path,e,!0)},mn.prototype.startAt=function(e,t){void 0===e&&(e=null),L("Query.startAt",0,2,arguments.length),He("Query.startAt",1,e,this.path,!0),ze("Query.startAt",2,t,!0);var n=this.queryParams_.startAt(e,t);if(mn.validateLimit_(n),mn.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(t=e=null),new mn(this.repo,this.path,n,this.orderByCalled_)},mn.prototype.endAt=function(e,t){void 0===e&&(e=null),L("Query.endAt",0,2,arguments.length),He("Query.endAt",1,e,this.path,!0),ze("Query.endAt",2,t,!0);var n=this.queryParams_.endAt(e,t);if(mn.validateLimit_(n),mn.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new mn(this.repo,this.path,n,this.orderByCalled_)},mn.prototype.equalTo=function(e,t){if(L("Query.equalTo",1,2,arguments.length),He("Query.equalTo",1,e,this.path,!1),ze("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},mn.prototype.toString=function(){return L("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},mn.prototype.toJSON=function(){return L("Query.toJSON",0,1,arguments.length),this.toString()},mn.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},mn.prototype.queryIdentifier=function(){var e=this.queryObject(),t=we(e);return"{}"===t?"default":t},mn.prototype.isEqual=function(e){if(L("Query.isEqual",1,1,arguments.length),!(e instanceof mn))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var t=this.repo===e.repo,n=this.path.equals(e.path),r=this.queryIdentifier()===e.queryIdentifier();return t&&n&&r},mn.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,W(e,3,r.cancel,!0),r.context=n,Q(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(M(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(mn.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),mn);function mn(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}var Cn=(En.prototype.getImmediateChild=function(e){return new En(this.node_.getImmediateChild(e))},En.prototype.node=function(){return this.node_},En);function En(e){this.node_=e}var wn=(bn.prototype.getImmediateChild=function(e){var t=this.path_.child(e);return new bn(this.syncTree_,t)},bn.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},bn);function bn(e,t){this.syncTree_=e,this.path_=t}function Sn(e,t,n,r){return Pn(t,new wn(n,e),r)}function Tn(e,t,n){return Pn(e,new Cn(t),n)}var In=function(e,t,n){return e&&"object"==typeof e?(c(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Nn(e[".sv"],t,n):"object"==typeof e[".sv"]?Rn(e[".sv"],t):void c(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Nn=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:c(!1,"Unexpected server value: "+e)}},Rn=function(e,t,n){e.hasOwnProperty("increment")||c(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&c(!1,"Unexpected increment value: "+r);var i=t.node();if(c(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!=typeof o?r:o+r};function Pn(e,t,n){var r,i=e.getPriority().val(),o=In(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=In(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new Tt(a,en(o)):e}var h=e;return o!==(r=h).getPriority().val()&&(r=r.updatePriority(new Tt(o))),h.forEachChild(Rt,(function(e,i){var o=Pn(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}var On,Dn,xn=(Fn.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&0<this.children.size){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},Fn.prototype.remember=function(e,t){if(e.isEmpty())this.value=t,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,t);else{var n=e.getFront();this.children.has(n)||this.children.set(n,new Fn);var r=this.children.get(n);e=e.popFront(),r.remember(e,t)}},Fn.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(Rt,(function(e,t){n.remember(new Pe(e),t)})),this.forget(e)}if(0<this.children.size){var r=e.getFront();return e=e.popFront(),!this.children.has(r)||this.children.get(r).forget(e)&&this.children.delete(r),0===this.children.size}return!0},Fn.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild((function(n,r){var i=new Pe(e.toString()+"/"+n);r.forEachTree(i,t)}))},Fn.prototype.forEachChild=function(e){this.children.forEach((function(t,n){e(n,t)}))},Fn);function Fn(){this.value=null,this.children=new Map}(Dn=On=On||{})[Dn.OVERWRITE=0]="OVERWRITE",Dn[Dn.MERGE=1]="MERGE",Dn[Dn.ACK_USER_WRITE=2]="ACK_USER_WRITE",Dn[Dn.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var kn=(An.User=new An(!0,!1,null,!1),An.Server=new An(!1,!0,null,!1),An.forServerTaggedQuery=function(e){return new An(!1,!0,e,!0)},An);function An(e,t,n,r){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=r,c(!r||t,"Tagged queries must be from server.")}var Ln,Mn=(Wn.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return c(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new Pe(e));return new Wn(Pe.Empty,t,this.revert)}return c(this.path.getFront()===e,"operationForChild called for unrelated child."),new Wn(this.path.popFront(),this.affectedTree,this.revert)},Wn);function Wn(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=On.ACK_USER_WRITE,this.source=kn.User}var Qn=(qn.fromObject=function(e){var t=qn.Empty;return be(e,(function(e,n){t=t.set(new Pe(e),n)})),t},qn.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},qn.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:Pe.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null==i?null:{path:new Pe(n).child(i.path),value:i.value}},qn.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},qn.prototype.subtree=function(e){if(e.isEmpty())return this;var t=e.getFront(),n=this.children.get(t);return null!==n?n.subtree(e.popFront()):qn.Empty},qn.prototype.set=function(e,t){if(e.isEmpty())return new qn(t,this.children);var n=e.getFront(),r=(this.children.get(n)||qn.Empty).set(e.popFront(),t),i=this.children.insert(n,r);return new qn(this.value,i)},qn.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?qn.Empty:new qn(null,this.children);var t=e.getFront(),n=this.children.get(t);if(n){var r=n.remove(e.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?qn.Empty:new qn(this.value,i)}return this},qn.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},qn.prototype.setTree=function(e,t){if(e.isEmpty())return t;var n,r=e.getFront(),i=(this.children.get(r)||qn.Empty).setTree(e.popFront(),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new qn(this.value,n)},qn.prototype.fold=function(e){return this.fold_(Pe.Empty,e)},qn.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(e.child(r),t)})),t(e,this.value,n)},qn.prototype.findOnPath=function(e,t){return this.findOnPath_(e,Pe.Empty,t)},qn.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),o=this.children.get(i);return o?o.findOnPath_(e.popFront(),t.child(i),n):null},qn.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,Pe.Empty,t)},qn.prototype.foreachOnPath_=function(e,t,n){if(e.isEmpty())return this;this.value&&n(t,this.value);var r=e.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(e.popFront(),t.child(r),n):qn.Empty},qn.prototype.foreach=function(e){this.foreach_(Pe.Empty,e)},qn.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(e.child(n),t)})),this.value&&t(e,this.value)},qn.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},qn.Empty=new qn(null),qn);function qn(e,t){void 0===t&&(t=Ln=Ln||new At(he)),this.value=e,this.children=t}var Un=(Hn.prototype.operationForChild=function(e){return this.path.isEmpty()?new Hn(this.source,Pe.Empty):new Hn(this.source,this.path.popFront())},Hn);function Hn(e,t){this.source=e,this.path=t,this.type=On.LISTEN_COMPLETE}var Vn=(jn.prototype.operationForChild=function(e){return this.path.isEmpty()?new jn(this.source,Pe.Empty,this.snap.getImmediateChild(e)):new jn(this.source,this.path.popFront(),this.snap)},jn);function jn(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=On.OVERWRITE}var Bn=(zn.prototype.operationForChild=function(e){if(this.path.isEmpty()){var t=this.children.subtree(new Pe(e));return t.isEmpty()?null:t.value?new Vn(this.source,Pe.Empty,t.value):new zn(this.source,Pe.Empty,t)}return c(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new zn(this.source,this.path.popFront(),this.children)},zn.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},zn);function zn(e,t,n){this.source=e,this.path=t,this.children=n,this.type=On.MERGE}var Yn=(Kn.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Kn.prototype.isFiltered=function(){return this.filtered_},Kn.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},Kn.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},Kn.prototype.getNode=function(){return this.node_},Kn);function Kn(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}var Gn=(Xn.prototype.updateEventSnap=function(e,t,n){return new Xn(new Yn(e,t,n),this.serverCache_)},Xn.prototype.updateServerSnap=function(e,t,n){return new Xn(this.eventCache_,new Yn(e,t,n))},Xn.prototype.getEventCache=function(){return this.eventCache_},Xn.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},Xn.prototype.getServerCache=function(){return this.serverCache_},Xn.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},Xn.Empty=new Xn(new Yn(Gt.EMPTY_NODE,!1,!1),new Yn(Gt.EMPTY_NODE,!1,!1)),Xn);function Xn(e,t){this.eventCache_=e,this.serverCache_=t}var $n=(Jn.valueChange=function(e){return new Jn(Jn.VALUE,e)},Jn.childAddedChange=function(e,t){return new Jn(Jn.CHILD_ADDED,t,e)},Jn.childRemovedChange=function(e,t){return new Jn(Jn.CHILD_REMOVED,t,e)},Jn.childChangedChange=function(e,t,n){return new Jn(Jn.CHILD_CHANGED,t,e,n)},Jn.childMovedChange=function(e,t){return new Jn(Jn.CHILD_MOVED,t,e)},Jn.CHILD_ADDED="child_added",Jn.CHILD_REMOVED="child_removed",Jn.CHILD_CHANGED="child_changed",Jn.CHILD_MOVED="child_moved",Jn.VALUE="value",Jn);function Jn(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}var Zn=(er.prototype.updateChild=function(e,t,n,r,i,o){c(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange($n.childRemovedChange(t,s)):c(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange($n.childAddedChange(t,n)):o.trackChildChange($n.childChangedChange(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},er.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Rt,(function(e,r){t.hasChild(e)||n.trackChildChange($n.childRemovedChange(e,r))})),t.isLeafNode()||t.forEachChild(Rt,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange($n.childChangedChange(t,r,i))}else n.trackChildChange($n.childAddedChange(t,r))}))),t.withIndex(this.index_)},er.prototype.updatePriority=function(e,t){return e.isEmpty()?Gt.EMPTY_NODE:e.updatePriority(t)},er.prototype.filtersNodes=function(){return!1},er.prototype.getIndexedFilter=function(){return this},er.prototype.getIndex=function(){return this.index_},er);function er(e){this.index_=e}var tr=(nr.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;c(t===$n.CHILD_ADDED||t===$n.CHILD_CHANGED||t===$n.CHILD_REMOVED,"Only child changes supported for tracking"),c(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(t===$n.CHILD_ADDED&&i===$n.CHILD_REMOVED)this.changeMap.set(n,$n.childChangedChange(n,e.snapshotNode,r.snapshotNode));else if(t===$n.CHILD_REMOVED&&i===$n.CHILD_ADDED)this.changeMap.delete(n);else if(t===$n.CHILD_REMOVED&&i===$n.CHILD_CHANGED)this.changeMap.set(n,$n.childRemovedChange(n,r.oldSnap));else if(t===$n.CHILD_CHANGED&&i===$n.CHILD_ADDED)this.changeMap.set(n,$n.childAddedChange(n,e.snapshotNode));else{if(t!==$n.CHILD_CHANGED||i!==$n.CHILD_CHANGED)throw p("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,$n.childChangedChange(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},nr.prototype.getChanges=function(){return Array.from(this.changeMap.values())},nr);function nr(){this.changeMap=new Map}function rr(){}var ir=new(rr.prototype.getCompleteChild=function(e){return null},rr.prototype.getChildAfterChild=function(e,t,n){return null},rr),or=(sr.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Yn(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},sr.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},sr);function sr(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}var ar=function(e,t){this.viewCache=e,this.changes=t},hr=(lr.prototype.assertIndexed=function(e){c(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),c(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},lr.prototype.applyOperation=function(e,t,n,r){var i,o,s=new tr;if(t.type===On.OVERWRITE){var a=t;i=a.source.fromUser?this.applyUserOverwrite_(e,a.path,a.snap,n,r,s):(c(a.source.fromServer,"Unknown source."),o=a.source.tagged||e.getServerCache().isFiltered()&&!a.path.isEmpty(),this.applyServerOverwrite_(e,a.path,a.snap,n,r,o,s))}else if(t.type===On.MERGE){var h=t;i=h.source.fromUser?this.applyUserMerge_(e,h.path,h.children,n,r,s):(c(h.source.fromServer,"Unknown source."),o=h.source.tagged||e.getServerCache().isFiltered(),this.applyServerMerge_(e,h.path,h.children,n,r,o,s))}else if(t.type===On.ACK_USER_WRITE){var l=t;i=l.revert?this.revertUserWrite_(e,l.path,n,r,s):this.ackUserWrite_(e,l.path,l.affectedTree,n,r,s)}else{if(t.type!==On.LISTEN_COMPLETE)throw p("Unknown operation type: "+t.type);i=this.listenComplete_(e,t.path,n,s)}var u=s.getChanges();return lr.maybeAddValueEvent_(e,i,u),new ar(i,u)},lr.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=e.getCompleteEventSnap();(0<n.length||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push($n.valueChange(t.getCompleteEventSnap()))}},lr.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var s=void 0,a=void 0;if(t.isEmpty())if(c(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var h=e.getCompleteServerSnap(),l=h instanceof Gt?h:Gt.EMPTY_NODE,u=n.calcCompleteEventChildren(l);s=this.filter_.updateFullNode(e.getEventCache().getNode(),u,i)}else{var p=n.calcCompleteEventCache(e.getCompleteServerSnap());s=this.filter_.updateFullNode(e.getEventCache().getNode(),p,i)}else{var d=t.getFront();if(".priority"===d){c(1===t.getLength(),"Can't have a priority with additional path components");var f=o.getNode();a=e.getServerCache().getNode();var y=n.calcEventCacheAfterServerOverwrite(t,f,a);s=null!=y?this.filter_.updatePriority(f,y):o.getNode()}else{var _=t.popFront(),v=void 0;if(o.isCompleteForChild(d)){a=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),a);v=null!=g?o.getNode().getImmediateChild(d).updateChild(_,g):o.getNode().getImmediateChild(d)}else v=n.calcCompleteChild(d,e.getServerCache());s=null!=v?this.filter_.updateChild(o.getNode(),d,v,_,r,i):o.getNode()}}return e.updateEventSnap(s,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},lr.prototype.applyServerOverwrite_=function(e,t,n,r,i,o,s){var a,h=e.getServerCache(),l=o?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())a=l.updateFullNode(h.getNode(),n,null);else if(l.filtersNodes()&&!h.isFiltered()){var u=h.getNode().updateChild(t,n);a=l.updateFullNode(h.getNode(),u,null)}else{var c=t.getFront();if(!h.isCompleteForPath(t)&&1<t.getLength())return e;var p=t.popFront(),d=h.getNode().getImmediateChild(c).updateChild(p,n);a=".priority"===c?l.updatePriority(h.getNode(),d):l.updateChild(h.getNode(),c,d,p,ir,null)}var f=e.updateServerSnap(a,h.isFullyInitialized()||t.isEmpty(),l.filtersNodes()),y=new or(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,y,s)},lr.prototype.applyUserOverwrite_=function(e,t,n,r,i,o){var s,a,h=e.getEventCache(),l=new or(r,e,i);if(t.isEmpty())a=this.filter_.updateFullNode(e.getEventCache().getNode(),n,o),s=e.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var u=t.getFront();if(".priority"===u)a=this.filter_.updatePriority(e.getEventCache().getNode(),n),s=e.updateEventSnap(a,h.isFullyInitialized(),h.isFiltered());else{var c=t.popFront(),p=h.getNode().getImmediateChild(u),d=void 0;if(c.isEmpty())d=n;else{var f=l.getCompleteChild(u);d=null!=f?".priority"===c.getBack()&&f.getChild(c.parent()).isEmpty()?f:f.updateChild(c,n):Gt.EMPTY_NODE}if(p.equals(d))s=e;else{var y=this.filter_.updateChild(h.getNode(),u,d,c,l,o);s=e.updateEventSnap(y,h.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},lr.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},lr.prototype.applyUserMerge_=function(e,t,n,r,i,o){var s=this,a=e;return n.foreach((function(n,h){var l=t.child(n);lr.cacheHasChild_(e,l.getFront())&&(a=s.applyUserOverwrite_(a,l,h,r,i,o))})),n.foreach((function(n,h){var l=t.child(n);lr.cacheHasChild_(e,l.getFront())||(a=s.applyUserOverwrite_(a,l,h,r,i,o))})),a},lr.prototype.applyMerge_=function(e,t){return t.foreach((function(t,n){e=e.updateChild(t,n)})),e},lr.prototype.applyServerMerge_=function(e,t,n,r,i,o,s){var a=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var h,l=e;h=t.isEmpty()?n:Qn.Empty.setTree(t,n);var u=e.getServerCache().getNode();return h.children.inorderTraversal((function(t,n){if(u.hasChild(t)){var h=e.getServerCache().getNode().getImmediateChild(t),c=a.applyMerge_(h,n);l=a.applyServerOverwrite_(l,new Pe(t),c,r,i,o,s)}})),h.children.inorderTraversal((function(t,n){var h=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!u.hasChild(t)&&!h){var c=e.getServerCache().getNode().getImmediateChild(t),p=a.applyMerge_(c,n);l=a.applyServerOverwrite_(l,new Pe(t),p,r,i,o,s)}})),l},lr.prototype.ackUserWrite_=function(e,t,n,r,i,o){if(null!=r.shadowingWrite(t))return e;var s=e.getServerCache().isFiltered(),a=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,a.getNode().getChild(t),r,i,s,o);if(t.isEmpty()){var h=Qn.Empty;return a.getNode().forEachChild(gt,(function(e,t){h=h.set(new Pe(e),t)})),this.applyServerMerge_(e,t,h,r,i,s,o)}return e}var l=Qn.Empty;return n.foreach((function(e,n){var r=t.child(e);a.isCompleteForPath(r)&&(l=l.set(e,a.getNode().getChild(r)))})),this.applyServerMerge_(e,t,l,r,i,s,o)},lr.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,n,ir,r)},lr.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var s=new or(n,e,r),a=e.getEventCache().getNode(),h=void 0;if(t.isEmpty()||".priority"===t.getFront()){var l=void 0;if(e.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var u=e.getServerCache().getNode();c(u instanceof Gt,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(u)}l=l,h=this.filter_.updateFullNode(a,l,i)}else{var p=t.getFront(),d=n.calcCompleteChild(p,e.getServerCache());null==d&&e.getServerCache().isCompleteForChild(p)&&(d=a.getImmediateChild(p)),(h=null!=d?this.filter_.updateChild(a,p,d,t.popFront(),s,i):e.getEventCache().getNode().hasChild(p)?this.filter_.updateChild(a,p,Gt.EMPTY_NODE,t.popFront(),s,i):a).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(h=this.filter_.updateFullNode(h,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Pe.Empty),e.updateEventSnap(h,o,this.filter_.filtersNodes())},lr);function lr(e){this.filter_=e}var ur=(cr.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],o=[];return e.forEach((function(e){e.type===$n.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push($n.childMovedChange(e.childName,e.snapshotNode))})),this.generateEventsForType_(i,$n.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,$n.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,$n.CHILD_MOVED,o,n,t),this.generateEventsForType_(i,$n.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,$n.VALUE,e,n,t),i},cr.prototype.generateEventsForType_=function(e,t,n,r,i){var o=this,s=n.filter((function(e){return e.type===t}));s.sort(this.compareChanges_.bind(this)),s.forEach((function(t){var n=o.materializeSingleChange_(t,i);r.forEach((function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,o.query_))}))}))},cr.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},cr.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw p("Should only compare child_ events.");var n=new lt(e.childName,e.snapshotNode),r=new lt(t.childName,t.snapshotNode);return this.index_.compare(n,r)},cr);function cr(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}var pr,dr=(fr.prototype.getQuery=function(){return this.query_},fr.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},fr.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},fr.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},fr.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},fr.prototype.removeEventRegistration=function(e,t){var n=[];if(t){c(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(e){t=t;var i=e.createCancelEvent(t,r);i&&n.push(i)}))}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},fr.prototype.applyOperation=function(e,t,n){e.type===On.MERGE&&null!==e.source.queryId&&(c(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),c(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),c(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},fr.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Rt,(function(e,t){n.push($n.childAddedChange(e,t))})),t.isFullyInitialized()&&n.push($n.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},fr.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},fr);function fr(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Zn(n.getIndex()),i=n.getNodeFilter();this.processor_=new hr(i);var o=t.getServerCache(),s=t.getEventCache(),a=r.updateFullNode(Gt.EMPTY_NODE,o.getNode(),null),h=i.updateFullNode(Gt.EMPTY_NODE,s.getNode(),null),l=new Yn(a,o.isFullyInitialized(),r.filtersNodes()),u=new Yn(h,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Gn(u,l),this.eventGenerator_=new ur(this.query_)}var yr=(Object.defineProperty(_r,"__referenceConstructor",{get:function(){return c(pr,"Reference.ts has not been loaded"),pr},set:function(e){c(!pr,"__referenceConstructor has already been defined"),pr=e},enumerable:!0,configurable:!0}),_r.prototype.isEmpty=function(){return 0===this.views.size},_r.prototype.applyOperation=function(e,t,n){var r,o,s=e.source.queryId;if(null!==s){var a=this.views.get(s);return c(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(e,t,n)}var h=[];try{for(var l=i(this.views.values()),u=l.next();!u.done;u=l.next())a=u.value,h=h.concat(a.applyOperation(e,t,n))}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return h},_r.prototype.addEventRegistration=function(e,t,n,r,i){var o=e.queryIdentifier(),s=this.views.get(o);if(!s){var a,h=n.calcCompleteEventCache(i?r:null);a=!!h||(h=r instanceof Gt?n.calcCompleteEventChildren(r):Gt.EMPTY_NODE,!1);var l=new Gn(new Yn(h,a,!1),new Yn(r,i,!1));s=new dr(e,l),this.views.set(o,s)}return s.addEventRegistration(t),s.getInitialEvents(t)},_r.prototype.removeEventRegistration=function(e,t,n){var r,s,a=e.queryIdentifier(),h=[],l=[],u=this.hasCompleteView();if("default"===a)try{for(var c=i(this.views.entries()),p=c.next();!p.done;p=c.next()){var d=o(p.value,2),f=d[0],y=d[1];l=l.concat(y.removeEventRegistration(t,n)),y.isEmpty()&&(this.views.delete(f),y.getQuery().getQueryParams().loadsAllData()||h.push(y.getQuery()))}}catch(e){r={error:e}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}else(y=this.views.get(a))&&(l=l.concat(y.removeEventRegistration(t,n)),y.isEmpty()&&(this.views.delete(a),y.getQuery().getQueryParams().loadsAllData()||h.push(y.getQuery())));return u&&!this.hasCompleteView()&&h.push(new _r.__referenceConstructor(e.repo,e.path)),{removed:h,events:l}},_r.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=i(this.views.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.getQuery().getQueryParams().loadsAllData()||n.push(s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},_r.prototype.getCompleteServerCache=function(e){var t,n,r=null;try{for(var o=i(this.views.values()),s=o.next();!s.done;s=o.next()){var a=s.value;r=r||a.getCompleteServerCache(e)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},_r.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},_r.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},_r.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},_r.prototype.getCompleteView=function(){var e,t;try{for(var n=i(this.views.values()),r=n.next();!r.done;r=n.next()){var o=r.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},_r);function _r(){this.views=new Map}var vr=(gr.prototype.addWrite=function(e,t){if(e.isEmpty())return new gr(new Qn(t));var n=this.writeTree_.findRootMostValueAndPath(e);if(null!=n){var r=n.path,i=n.value,o=Pe.relativePath(r,e);return i=i.updateChild(o,t),new gr(this.writeTree_.set(r,i))}var s=new Qn(t);return new gr(this.writeTree_.setTree(e,s))},gr.prototype.addWrites=function(e,t){var n=this;return be(t,(function(t,r){n=n.addWrite(e.child(t),r)})),n},gr.prototype.removeWrite=function(e){return e.isEmpty()?gr.Empty:new gr(this.writeTree_.setTree(e,Qn.Empty))},gr.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},gr.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(Pe.relativePath(t.path,e)):null},gr.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Rt,(function(t,n){e.push(new lt(t,n))})):this.writeTree_.children.inorderTraversal((function(t,n){null!=n.value&&e.push(new lt(t,n.value))})),e},gr.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var t=this.getCompleteNode(e);return new gr(null!=t?new Qn(t):this.writeTree_.subtree(e))},gr.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},gr.prototype.apply=function(e){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(c(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(t.child(n),o,r)})),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(t.child(".priority"),i)),r}(Pe.Empty,this.writeTree_,e)},gr.Empty=new gr(new Qn(null)),gr);function gr(e){this.writeTree_=e}var mr=(Cr.prototype.childWrites=function(e){return new Er(e,this)},Cr.prototype.addOverwrite=function(e,t,n,r){c(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},Cr.prototype.addMerge=function(e,t,n){c(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},Cr.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},Cr.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex((function(t){return t.writeId===e}));c(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&0<=s;){var a=this.allWrites_[s];a.visible&&(n<=s&&this.recordContainsPath_(a,r.path)?i=!1:r.path.contains(a.path)&&(o=!0)),s--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):be(r.children,(function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(r.path.child(e))})),!0)},Cr.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},Cr.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Pe.Empty)){var o=Cr.layerTree_(this.allWrites_,(function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))}),e);return h=t||Gt.EMPTY_NODE,o.apply(h)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var a=this.visibleWrites_.childCompoundWrite(e);if(a.isEmpty())return t;if(null!=t||a.hasCompleteWrite(Pe.Empty)){var h=t||Gt.EMPTY_NODE;return a.apply(h)}return null},Cr.prototype.calcCompleteEventChildren=function(e,t){var n=Gt.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(Rt,(function(e,t){n=n.updateImmediateChild(e,t)})),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(Rt,(function(e,t){var r=i.childCompoundWrite(new Pe(e)).apply(t);n=n.updateImmediateChild(e,r)})),i.getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n},Cr.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){c(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(t):o.apply(r.getChild(t))},Cr.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},Cr.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},Cr.prototype.calcIndexedSlice=function(e,t,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(e),h=a.getCompleteNode(Pe.Empty);if(null!=h)s=h;else{if(null==t)return[];s=a.apply(t)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var l=[],u=o.getCompare(),c=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),p=c.getNext();p&&l.length<r;)0!==u(p,n)&&l.push(p),p=c.getNext();return l},Cr.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},Cr.prototype.resetTree_=function(){this.visibleWrites_=Cr.layerTree_(this.allWrites_,Cr.DefaultFilter_,Pe.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Cr.DefaultFilter_=function(e){return e.visible},Cr.layerTree_=function(e,t,n){for(var r=vr.Empty,i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,a=void 0;if(o.snap)n.contains(s)?(a=Pe.relativePath(n,s),r=r.addWrite(a,o.snap)):s.contains(n)&&(a=Pe.relativePath(s,n),r=r.addWrite(Pe.Empty,o.snap.getChild(a)));else{if(!o.children)throw p("WriteRecord should have .snap or .children");if(n.contains(s))a=Pe.relativePath(n,s),r=r.addWrites(a,o.children);else if(s.contains(n))if((a=Pe.relativePath(s,n)).isEmpty())r=r.addWrites(Pe.Empty,o.children);else{var h=R(o.children,a.getFront());if(h){var l=h.getChild(a.popFront());r=r.addWrite(Pe.Empty,l)}}}}}return r},Cr);function Cr(){this.visibleWrites_=vr.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Er=(wr.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},wr.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},wr.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},wr.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},wr.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},wr.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},wr.prototype.child=function(e){return new wr(this.treePath_.child(e),this.writeTree_)},wr);function wr(e,t){this.treePath_=e,this.writeTree_=t}var br=(Sr.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new Vn(kn.User,e,t)):[]},Sr.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=Qn.fromObject(t);return this.applyOperationToSyncPoints_(new Bn(kn.User,e,r))},Sr.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=Qn.Empty;return null!=n.snap?r=r.set(Pe.Empty,!0):be(n.children,(function(e,t){r=r.set(new Pe(e),t)})),this.applyOperationToSyncPoints_(new Mn(n.path,r,t))}return[]},Sr.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new Vn(kn.Server,e,t))},Sr.prototype.applyServerMerge=function(e,t){var n=Qn.fromObject(t);return this.applyOperationToSyncPoints_(new Bn(kn.Server,e,n))},Sr.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new Un(kn.Server,e))},Sr.prototype.applyTaggedQueryOverwrite=function(e,t,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=Sr.parseQueryKey_(r),o=i.path,s=i.queryId,a=Pe.relativePath(o,e),h=new Vn(kn.forServerTaggedQuery(s),a,t);return this.applyTaggedOperation_(o,h)},Sr.prototype.applyTaggedQueryMerge=function(e,t,n){var r=this.queryKeyForTag_(n);if(r){var i=Sr.parseQueryKey_(r),o=i.path,s=i.queryId,a=Pe.relativePath(o,e),h=Qn.fromObject(t),l=new Bn(kn.forServerTaggedQuery(s),a,h);return this.applyTaggedOperation_(o,l)}return[]},Sr.prototype.applyTaggedListenComplete=function(e,t){var n=this.queryKeyForTag_(t);if(n){var r=Sr.parseQueryKey_(n),i=r.path,o=r.queryId,s=Pe.relativePath(i,e),a=new Un(kn.forServerTaggedQuery(o),s);return this.applyTaggedOperation_(i,a)}return[]},Sr.prototype.addEventRegistration=function(e,t){var n=e.path,r=null,i=!1;this.syncPointTree_.foreachOnPath(n,(function(e,t){var o=Pe.relativePath(e,n);r=r||t.getCompleteServerCache(o),i=i||t.hasCompleteView()}));var o,s=this.syncPointTree_.get(n);s?(i=i||s.hasCompleteView(),r=r||s.getCompleteServerCache(Pe.Empty)):(s=new yr,this.syncPointTree_=this.syncPointTree_.set(n,s)),null!=r?o=!0:(o=!1,r=Gt.EMPTY_NODE,this.syncPointTree_.subtree(n).foreachChild((function(e,t){var n=t.getCompleteServerCache(Pe.Empty);n&&(r=r.updateImmediateChild(e,n))})));var a=s.viewExistsForQuery(e);if(!a&&!e.getQueryParams().loadsAllData()){var h=Sr.makeQueryKey_(e);c(!this.queryToTagMap.has(h),"View does not exist, but we have a tag");var l=Sr.getNextQueryTag_();this.queryToTagMap.set(h,l),this.tagToQueryMap.set(l,h)}var u=this.pendingWriteTree_.childWrites(n),p=s.addEventRegistration(e,t,u,r,o);if(!a&&!i){var d=s.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},Sr.prototype.removeEventRegistration=function(e,t,n){var r=this,i=e.path,o=this.syncPointTree_.get(i),s=[];if(o&&("default"===e.queryIdentifier()||o.viewExistsForQuery(e))){var a=o.removeEventRegistration(e,t,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var h=a.removed;s=a.events;var l=-1!==h.findIndex((function(e){return e.getQueryParams().loadsAllData()})),u=this.syncPointTree_.findOnPath(i,(function(e,t){return t.hasCompleteView()}));if(l&&!u){var c=this.syncPointTree_.subtree(i);if(!c.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(c),d=0;d<p.length;++d){var f=p[d],y=f.getQuery(),_=this.createListenerForView_(f);this.listenProvider_.startListening(Sr.queryForListening_(y),this.tagForQuery_(y),_.hashFn,_.onComplete)}}!u&&0<h.length&&!n&&(l?this.listenProvider_.stopListening(Sr.queryForListening_(e),null):h.forEach((function(e){var t=r.queryToTagMap.get(Sr.makeQueryKey_(e));r.listenProvider_.stopListening(Sr.queryForListening_(e),t)}))),this.removeTags_(h)}return s},Sr.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,(function(t,n){var r=Pe.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(e,r,t,!0)},Sr.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),be(n,(function(e,t){r=r.concat(t)})),r}))},Sr.prototype.removeTags_=function(e){for(var t=0;t<e.length;++t){var n=e[t];if(!n.getQueryParams().loadsAllData()){var r=Sr.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},Sr.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},Sr.prototype.setupListener_=function(e,t){var n=e.path,r=this.tagForQuery_(e),i=this.createListenerForView_(t),o=this.listenProvider_.startListening(Sr.queryForListening_(e),r,i.hashFn,i.onComplete),s=this.syncPointTree_.subtree(n);if(r)c(!s.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var a=s.fold((function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map((function(e){return e.getQuery()})))),be(n,(function(e,t){r=r.concat(t)})),r})),h=0;h<a.length;++h){var l=a[h];this.listenProvider_.stopListening(Sr.queryForListening_(l),this.tagForQuery_(l))}return o},Sr.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||Gt.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},Sr.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},Sr.parseQueryKey_=function(e){var t=e.indexOf("$");return c(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Pe(e.substr(0,t))}},Sr.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},Sr.prototype.tagForQuery_=function(e){var t=Sr.makeQueryKey_(e);return this.queryToTagMap.get(t)},Sr.getNextQueryTag_=function(){return Sr.nextQueryTag_++},Sr.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);c(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},Sr.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Pe.Empty))},Sr.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(Pe.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Pe.Empty));var o=[],s=e.path.getFront(),a=e.operationForChild(s),h=t.children.get(s);if(h&&a){var l=n?n.getImmediateChild(s):null,u=r.child(s);o=o.concat(this.applyOperationHelper_(a,h,l,u))}return i&&(o=o.concat(i.applyOperation(e,r,n))),o},Sr.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,o=t.get(Pe.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(Pe.Empty));var s=[];return t.children.inorderTraversal((function(t,o){var a=n?n.getImmediateChild(t):null,h=r.child(t),l=e.operationForChild(t);l&&(s=s.concat(i.applyOperationDescendantsHelper_(l,o,a,h)))})),o&&(s=s.concat(o.applyOperation(e,r,n))),s},Sr.nextQueryTag_=1,Sr);function Sr(e){this.listenProvider_=e,this.syncPointTree_=Qn.Empty,this.pendingWriteTree_=new mr,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Tr=(Ir.prototype.getNode=function(e){return this.rootNode_.getChild(e)},Ir.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},Ir);function Ir(){this.rootNode_=Gt.EMPTY_NODE}var Nr=(Rr.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(ne("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):Promise.resolve(null)},Rr.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout((function(){return e(null)}),0),this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)})))},Rr.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},Rr.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',se(e)},Rr);function Rr(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then((function(e){return n.auth_=e}))}var Pr=(Or.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),N(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},Or.prototype.get=function(){return function(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(var r in n)n.hasOwnProperty(r)&&(t[r]=e(t[r],n[r]));return t}(void 0,e)}(this.counters_)},Or);function Or(){this.counters_={}}var Dr=(xr.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Pr),this.collections_[t]},xr.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},xr.collections_={},xr.reporters_={},xr);function xr(){}var Fr=(kr.prototype.get=function(){var e=this.collection_.get(),t=r({},e);return this.last_&&be(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},kr);function kr(e){this.collection_=e,this.last_=null}var Ar=(Lr.prototype.includeStat=function(e){this.statsToReport_[e]=!0},Lr.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;be(t,(function(t,i){0<i&&N(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),Ie(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},Lr);function Lr(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Fr(e);var n=1e4+2e4*Math.random();Ie(this.reportStats_.bind(this),Math.floor(n))}var Mr=(Wr.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new Qr(i)),t.add(r)}t&&this.eventLists_.push(t)},Wr.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.equals(e)}))},Wr.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.contains(e)||e.contains(t)}))},Wr.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1)}t&&(this.eventLists_=[]),this.recursionDepth_--},Wr);function Wr(){this.eventLists_=[],this.recursionDepth_=0}var Qr=(qr.prototype.add=function(e){this.events_.push(e)},qr.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();ve&&ne("event: "+t.toString()),Te(n)}}},qr.prototype.getPath=function(){return this.path_},qr);function qr(e){this.path_=e,this.events_=[]}var Ur=(Hr.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=s(this.listeners_[e]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},Hr.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},Hr.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},Hr.prototype.validateEventType_=function(e){c(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},Hr);function Hr(e){this.allowedEvents_=e,this.listeners_={},c(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}var Vr,jr=(n(Br,Vr=Ur),Br.getInstance=function(){return new Br},Br.prototype.getInitialEvent=function(e){return c("visible"===e,"Unknown event type: "+e),[this.visible_]},Br);function Br(){var e,t,n=Vr.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,(function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))}),!1),n}var zr,Yr=(n(Kr,zr=Ur),Kr.getInstance=function(){return new Kr},Kr.prototype.getInitialEvent=function(e){return c("online"===e,"Unknown event type: "+e),[this.online_]},Kr.prototype.currentlyOnline=function(){return this.online_},Kr);function Kr(){var e=zr.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||_()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}var Gr=(Xr.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},Xr.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Te((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},Xr);function Xr(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var $r=(Jr.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Gr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Zr((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o(e,5),i=r[0],s=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=s,n.password=a;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o(e,2),i=r[0],s=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,s)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Fe)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},Jr.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},Jr.forceAllow=function(){Jr.forceAllow_=!0},Jr.forceDisallow=function(){Jr.forceDisallow_=!0},Jr.isAvailable=function(){return!!Jr.forceAllow_||!(Jr.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},Jr.prototype.markConnectionHealthy=function(){},Jr.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},Jr.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},Jr.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},Jr.prototype.send=function(e){var t=T(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n,r=ue((n=a(t),d.encodeByteArray(n,!0)),1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},Jr.prototype.addDisconnectPingFrame=function(e,t){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},Jr.prototype.incrementIncomingBytes_=function(e){var t=T(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},Jr);function Jr(e,t,n,r){this.connId=e,this.repoInfo=t,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=re(e),this.stats_=Dr.getCollection(t),this.urlFn=function(e){return t.connectionURL(Ae,e)}}var Zr=(ei.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||ne("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},ei.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},ei.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},ei.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},ei.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},ei.prototype.addLongPollTag_=function(e,t){var n=this;function r(){n.outstandingRequests.delete(t),n.newRequest_()}this.outstandingRequests.add(t);var i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},ei.prototype.addTag=function(e,t){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){ne("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},ei);function ei(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=ye(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ei.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(e){ne("frame writing exception"),e.stack&&ne(e.stack),ne(e)}}var ti="",ni=null;"undefined"!=typeof MozWebSocket?ni=MozWebSocket:"undefined"!=typeof WebSocket&&(ni=WebSocket);var ri=(ii.connectionURL_=function(e,t,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Fe)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL(ke,r)},ii.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,pe.set("previous_websocket_failure",!0);try{if(v()){var r=l?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+ti+"/"+process.platform+"/"+r}},o=process.env,s=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;s&&(i.proxy={origin:s}),this.mySock=new ni(this.connURL,[],i)}else this.mySock=new ni(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");var a=e.message||e.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},ii.prototype.start=function(){},ii.forceDisallow=function(){ii.forceDisallow_=!0},ii.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0)}return!e&&null!==ni&&!ii.forceDisallow_},ii.previouslyFailed=function(){return pe.isInMemoryStorage||!0===pe.get("previous_websocket_failure")},ii.prototype.markConnectionHealthy=function(){pe.remove("previous_websocket_failure")},ii.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=S(t);this.onMessage(n)}},ii.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},ii.prototype.extractFrameCount_=function(e){if(c(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},ii.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},ii.prototype.send=function(e){this.resetKeepAlive();var t=T(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=ue(t,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},ii.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},ii.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},ii.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},ii.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},ii.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},ii.responsesRequiredToBeHealthy=2,ii.healthyTimeout=3e4,ii);function ii(e,t,n,r){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=re(this.connId),this.stats_=Dr.getCollection(t),this.connURL=ii.connectionURL_(t,n,r)}var oi=(Object.defineProperty(si,"ALL_TRANSPORTS",{get:function(){return[$r,ri]},enumerable:!0,configurable:!0}),si.prototype.initTransports_=function(e){var t,n,r=ri&&ri.isAvailable(),o=r&&!ri.previouslyFailed();if(e.webSocketOnly&&(r||se("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[ri];else{var s=this.transports_=[];try{for(var a=i(si.ALL_TRANSPORTS),h=a.next();!h.done;h=a.next()){var l=h.value;l&&l.isAvailable()&&s.push(l)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}},si.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},si.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},si);function si(e){this.initTransports_(e)}var ai=(hi.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;0<i&&(this.healthyTimeout_=Ie((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&102400<e.conn_.bytesReceived?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&10240<e.conn_.bytesSent?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},hi.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},hi.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},hi.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},hi.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},hi.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},hi.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},hi.prototype.onSecondaryMessageReceived_=function(e){var t=le("t",e),n=le("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},hi.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},hi.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},hi.prototype.onPrimaryMessageReceived_=function(e){var t=le("t",e),n=le("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},hi.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},hi.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},hi.prototype.onControl_=function(e){var t=le("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?ie("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ie("Unknown control packet command: "+t)}},hi.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&se("Protocol version mismatch detected"),this.tryStartUpgrade_())},hi.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},hi.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ie((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},hi.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},hi.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ie((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},hi.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},hi.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},hi.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(pe.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},hi.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},hi.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},hi.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},hi.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},hi);function hi(e,t,n,r,i,o,s){this.id=e,this.repoInfo_=t,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=re("c:"+this.id+":"),this.transportManager_=new oi(t),this.log_("Connection created"),this.start_()}var li=(ui.prototype.put=function(e,t,n,r){},ui.prototype.merge=function(e,t,n,r){},ui.prototype.refreshAuthToken=function(e){},ui.prototype.onDisconnectPut=function(e,t,n){},ui.prototype.onDisconnectMerge=function(e,t,n){},ui.prototype.onDisconnectCancel=function(e,t){},ui.prototype.reportStats=function(e){},ui);function ui(){}var ci,pi=(n(di,ci=li),di.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(T(i)),c(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},di.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),c(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),c(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},di.prototype.sendListen_=function(e){var t=this,n=e.query,r=n.path.toString(),i=n.queryIdentifier();this.log_("Listen on "+r+" for "+i);var o={p:r};e.tag&&(o.q=n.queryObject(),o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var s=o.d,a=o.s;di.warnOnListenWarnings_(s,n),(t.listens.get(r)&&t.listens.get(r).get(i))===e&&(t.log_("listen response",o),"ok"!==a&&t.removeListen_(r,i),e.onComplete&&e.onComplete(a,s))}))},di.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&N(e,"w")){var n=R(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&se('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+t.getQueryParams().getIndex().toString()+'" at '+t.path.toString()+" to your security rules for better performance.")}},di.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},di.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t;(e&&40===e.length||"object"==typeof(t=I(e).claims)&&!0===t.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},di.prototype.tryAuth=function(){var e,t=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(e=I(n).claims)&&"object"==typeof e&&e.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(r,i,(function(e){var r=e.s,i=e.d||"error";t.authToken_===n&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},di.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),c(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},di.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},di.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},di.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},di.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},di.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},di.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},di.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},di.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},di.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},di.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},di.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+T(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},di.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ie("Unrecognized action received from server: "+T(e)+"\nAre you using the latest client?")},di.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},di.prototype.scheduleConnect_=function(e){var t=this;c(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},di.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},di.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},di.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},di.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+di.nextConnectionId_++,i=this,o=this.lastSessionId,s=!1,a=null,h=function(){a?a.close():(s=!0,n())};this.realtime_={close:h,sendRequest:function(e){c(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)}};var l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(l).then((function(h){s?ne("getToken() completed but was canceled"):(ne("getToken() completed. Creating connection."),i.authToken_=h&&h.accessToken,a=new ai(r,i.repoInfo_,e,t,n,(function(e){se(e+" ("+i.repoInfo_.toString()+")"),i.interrupt("server_kill")}),o))})).then(null,(function(e){i.log_("Failed to get token: "+e),s||h()}))}},di.prototype.interrupt=function(e){ne("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},di.prototype.resume=function(e){ne("Resuming connection for reason: "+e),delete this.interruptReasons_[e],P(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},di.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},di.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},di.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return we(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},di.prototype.removeListen_=function(e,t){var n,r=new Pe(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},di.prototype.onAuthRevoked_=function(e,t){ne("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},di.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},di.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var o=i(this.listens.values()),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(n=void 0,i(a.values())),l=h.next();!l.done;l=h.next()){var u=l.value;this.sendListen_(u)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var p=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}},di.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+ti.replace(/\./g,"-")]=1,_()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)},di.prototype.shouldReconnect_=function(){var e=Yr.getInstance().currentlyOnline();return P(this.interruptReasons_)&&e},di.nextPersistentConnectionId_=0,di.nextConnectionId_=0,di);function di(e,t,n,r,i,o){var s=ci.call(this)||this;if(s.repoInfo_=e,s.onDataUpdate_=t,s.onConnectStatus_=n,s.onServerInfoUpdate_=r,s.authTokenProvider_=i,s.authOverride_=o,s.id=di.nextPersistentConnectionId_++,s.log_=re("p:"+s.id+":"),s.interruptReasons_={},s.listens=new Map,s.outstandingPuts_=[],s.outstandingPutCount_=0,s.onDisconnectRequestQueue_=[],s.connected_=!1,s.reconnectDelay_=1e3,s.maxReconnectDelay_=3e5,s.securityDebugCallback_=null,s.lastSessionId=null,s.establishConnectionTimer_=null,s.visible_=!1,s.requestCBHash_={},s.requestNumber_=0,s.realtime_=null,s.authToken_=null,s.forceTokenRefresh_=!1,s.invalidAuthTokenCount_=0,s.firstConnection_=!0,s.lastConnectionAttemptTime_=null,s.lastConnectionEstablishedTime_=null,o&&!v())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return s.scheduleConnect_(0),jr.getInstance().on("visible",s.onVisible_,s),-1===e.host.indexOf("fblocal")&&Yr.getInstance().on("online",s.onOnline_,s),s}var fi,yi=(n(_i,fi=li),_i.prototype.reportStats=function(e){throw new Error("Method not implemented.")},_i.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(c(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},_i.prototype.listen=function(e,t,n,r){var i=this,o=e.path.toString();this.log_("Listen called for "+o+" "+e.queryIdentifier());var s=_i.getListenId_(e,n),a={};this.listens_[s]=a;var h=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",h,(function(e,t){var h=t;404===e&&(e=h=null),null===e&&i.onDataUpdate_(o,h,!1,n),R(i.listens_,s)===a&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},_i.prototype.unlisten=function(e,t){var n=_i.getListenId_(e,t);delete this.listens_[n]},_i.prototype.refreshAuthToken=function(e){},_i.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(t.auth=o);var s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+function(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var o=i[r];n(o[0],o[1])}return t.length?"&"+t.join("&"):""}(t);r.log_("Sending REST request for "+s);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(n&&4===a.readyState){r.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);var e=null;if(200<=a.status&&a.status<300){try{e=S(a.responseText)}catch(e){se("Failed to parse JSON response for "+s+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&se("Got unsuccessful REST response for "+s+" Status: "+a.status),n(a.status);n=null}},a.open("GET",s,!0),a.send()}))},_i);function _i(e,t,n){var r=fi.call(this)||this;return r.repoInfo_=e,r.onDataUpdate_=t,r.authTokenProvider_=n,r.log_=re("p:rest:"),r.listens_={},r}var vi="repo_interrupt",gi=(mi.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},mi.prototype.name=function(){return this.repoInfo_.namespace},mi.prototype.serverTime=function(){var e=this.infoData_.getNode(new Pe(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},mi.prototype.generateServerValues=function(){return(e=e={timestamp:this.serverTime()}).timestamp=e.timestamp||(new Date).getTime(),e;var e},mi.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new Pe(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var s=O(t,(function(e){return en(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var a=en(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,a,r)}else if(n){var h=O(t,(function(e){return en(e)}));o=this.serverSyncTree_.applyServerMerge(i,h)}else{var l=en(t);o=this.serverSyncTree_.applyServerOverwrite(i,l)}var u=i;0<o.length&&(u=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(u,o)},mi.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},mi.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},mi.prototype.onServerInfoUpdate_=function(e){var t=this;be(e,(function(e,n){t.updateInfo_(e,n)}))},mi.prototype.updateInfo_=function(e,t){var n=new Pe("/.info/"+e),r=en(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},mi.prototype.getNextWriteId_=function(){return this.nextWriteId_++},mi.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var o=this.generateServerValues(),s=en(t,n),a=Tn(s,this.serverSyncTree_.calcCompleteEventCache(e),o),h=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,a,h,!0);this.eventQueue_.queueEvents(l),this.server_.put(e.toString(),s.val(!0),(function(t,n){var o="ok"===t;o||se("set at "+e+" failed: "+t);var s=i.serverSyncTree_.ackUserWrite(h,!o);i.eventQueue_.raiseEventsForChangedPath(e,s),i.callOnCompleteCallback(r,t,n)}));var u=this.abortTransactions_(e);this.rerunTransactions_(u),this.eventQueue_.raiseEventsForChangedPath(u,[])},mi.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,o=this.generateServerValues(),s={};if(be(t,(function(t,n){i=!1,s[t]=Sn(e.child(t),en(n),r.serverSyncTree_,o)})),i)ne("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserMerge(e,s,a);this.eventQueue_.queueEvents(h),this.server_.merge(e.toString(),t,(function(t,i){var o="ok"===t;o||se("update at "+e+" failed: "+t);var s=r.serverSyncTree_.ackUserWrite(a,!o),h=0<s.length?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(h,s),r.callOnCompleteCallback(n,t,i)})),be(t,(function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(e,[])}},mi.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new xn;this.onDisconnect_.forEachTree(Pe.Empty,(function(r,i){var o=Sn(r,i,e.serverSyncTree_,t);n.remember(r,o)}));var r=[];n.forEachTree(Pe.Empty,(function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)})),this.onDisconnect_=new xn,this.eventQueue_.raiseEventsForChangedPath(Pe.Empty,r)},mi.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)}))},mi.prototype.onDisconnectSet=function(e,t,n){var r=this,i=en(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),(function(t,o){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,o)}))},mi.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,o=en(t,n);this.server_.onDisconnectPut(e.toString(),o.val(!0),(function(t,n){"ok"===t&&i.onDisconnect_.remember(e,o),i.callOnCompleteCallback(r,t,n)}))},mi.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(P(t))return ne("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,(function(i,o){"ok"===i&&be(t,(function(t,n){var i=en(n);r.onDisconnect_.remember(e.child(t),i)})),r.callOnCompleteCallback(n,i,o)}))},mi.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},mi.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},mi.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(vi)},mi.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(vi)},mi.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;t=e?(this.statsListener_||(this.statsListener_=new Fr(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);be(t,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))}},mi.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},mi.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),ne.apply(void 0,s([n],e))},mi.prototype.callOnCompleteCallback=function(e,t,n){e&&Te((function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,e(o)}}))},Object.defineProperty(mi.prototype,"database",{get:function(){return this.__database||(this.__database=new Wi(this))},enumerable:!0,configurable:!0}),mi);function mi(e,t,n,r){var i=this;this.repoInfo_=e,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Mr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new xn,this.persistentConnection_=null;var o=new Nr(n,r);if(this.stats_=Dr.getCollection(e),t||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new yi(this.repoInfo_,this.onDataUpdate_.bind(this),o),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{T(s)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}this.persistentConnection_=new pi(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),o,s),this.server_=this.persistentConnection_}o.addTokenChangeListener((function(e){i.server_.refreshAuthToken(e)})),this.statsReporter_=Dr.getOrCreateReporter(e,(function(){return new Ar(i.stats_,i.server_)})),this.transactionsInit_(),this.infoData_=new Tr,this.infoSyncTree_=new br({startListening:function(e,t,n,r){var o=[],s=i.infoData_.getNode(e.path);return s.isEmpty()||(o=i.infoSyncTree_.applyServerOverwrite(e.path,s),setTimeout((function(){r("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new br({startListening:function(e,t,n,r){return i.server_.listen(e,n,t,(function(t,n){var o=r(t,n);i.eventQueue_.raiseEventsForChangedPath(e.path,o)})),[]},stopListening:function(e,t){i.server_.unlisten(e,t)}})}var Ci=(Ei.prototype.getStartPost=function(){return this.startPost_},Ei.prototype.getEndPost=function(){return this.endPost_},Ei.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},Ei.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new lt(t,n))||(n=Gt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},Ei.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=Gt.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(Gt.EMPTY_NODE);var i=this;return t.forEachChild(Rt,(function(e,t){i.matches(new lt(e,t))||(r=r.updateImmediateChild(e,Gt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},Ei.prototype.updatePriority=function(e,t){return e},Ei.prototype.filtersNodes=function(){return!0},Ei.prototype.getIndexedFilter=function(){return this.indexedFilter_},Ei.prototype.getIndex=function(){return this.index_},Ei.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},Ei.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},Ei);function Ei(e){this.indexedFilter_=new Zn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ei.getStartPost_(e),this.endPost_=Ei.getEndPost_(e)}var wi=(bi.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new lt(t,n))||(n=Gt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},bi.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=Gt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=Gt.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(Gt.EMPTY_NODE);var a=void 0,h=void 0,l=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),h=this.rangedFilter_.getStartPost();var u=this.index_.getCompare();l=function(e,t){return u(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),h=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();o=0;for(var c=!1;i.hasNext();)s=i.getNext(),!c&&l(a,s)<=0&&(c=!0),c&&o<this.limit_&&l(s,h)<=0?o++:r=r.updateImmediateChild(s.name,Gt.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},bi.prototype.updatePriority=function(e,t){return e},bi.prototype.filtersNodes=function(){return!0},bi.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},bi.prototype.getIndex=function(){return this.index_},bi.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else o=this.index_.getCompare();var a=e;c(a.numChildren()===this.limit_,"");var h=new lt(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(h);if(a.hasChild(t)){for(var p=a.getImmediateChild(t),d=r.getChildAfterChild(this.index_,l,this.reverse_);null!=d&&(d.name===t||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);var f=null==d?1:o(d,h);if(u&&!n.isEmpty()&&0<=f)return null!=i&&i.trackChildChange($n.childChangedChange(t,n,p)),a.updateImmediateChild(t,n);null!=i&&i.trackChildChange($n.childRemovedChange(t,p));var y=a.updateImmediateChild(t,Gt.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange($n.childAddedChange(d.name,d.node)),y.updateImmediateChild(d.name,d.node)):y}return!n.isEmpty()&&u&&0<=o(l,h)?(null!=i&&(i.trackChildChange($n.childRemovedChange(l.name,l.node)),i.trackChildChange($n.childAddedChange(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,Gt.EMPTY_NODE)):e},bi);function bi(e){this.rangedFilter_=new Ci(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}var Si=(Ti.prototype.hasStart=function(){return this.startSet_},Ti.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Ti.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Ti.prototype.getIndexStartValue=function(){return c(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Ti.prototype.getIndexStartName=function(){return c(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:me},Ti.prototype.hasEnd=function(){return this.endSet_},Ti.prototype.getIndexEndValue=function(){return c(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Ti.prototype.getIndexEndName=function(){return c(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ce},Ti.prototype.hasLimit=function(){return this.limitSet_},Ti.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Ti.prototype.getLimit=function(){return c(this.limitSet_,"Only valid if limit has been set"),this.limit_},Ti.prototype.getIndex=function(){return this.index_},Ti.prototype.copy_=function(){var e=new Ti;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},Ti.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},Ti.prototype.limitToFirst=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=Ti.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,t},Ti.prototype.limitToLast=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=Ti.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,t},Ti.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},Ti.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},Ti.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},Ti.prototype.getQueryObject=function(){var e=Ti.WIRE_PROTOCOL_CONSTANTS_,t={};if(this.startSet_&&(t[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(t[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(t[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(t[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){t[e.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),t[e.VIEW_FROM]=n}return this.index_!==Rt&&(t[e.INDEX]=this.index_.toString()),t},Ti.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Ti.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Rt},Ti.prototype.getNodeFilter=function(){return this.loadsAllData()?new Zn(this.getIndex()):new(this.hasLimit()?wi:Ci)(this)},Ti.prototype.toRestQueryStringParameters=function(){var e,t=Ti.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(e=this.index_===Rt?t.PRIORITY_INDEX:this.index_===rn?t.VALUE_INDEX:this.index_===gt?t.KEY_INDEX:(c(this.index_ instanceof on,"Unrecognized index type!"),this.index_.toString()),n[t.ORDER_BY]=T(e),this.startSet_&&(n[t.START_AT]=T(this.indexStartValue_),this.startNameSet_&&(n[t.START_AT]+=","+T(this.indexStartName_))),this.endSet_&&(n[t.END_AT]=T(this.indexEndValue_),this.endNameSet_&&(n[t.END_AT]+=","+T(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[t.LIMIT_TO_FIRST]=this.limit_:n[t.LIMIT_TO_LAST]=this.limit_)),n},Ti.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Ti.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Ti.DEFAULT=new Ti,Ti);function Ti(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Rt}var Ii,Ni=(n(Ri,Ii=gn),Ri.prototype.getKey=function(){return L("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Ri.prototype.child=function(e){var t,n,r;return L("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof Pe||(null===this.path.getFront()?(r=!(t=1),Ye("Reference.child",t,n=(n=e)&&n.replace(/^\/*\.info(\/|$)/,"/"),r)):Ye("Reference.child",1,e,!1)),new Ri(this.repo,this.path.child(e))},Ri.prototype.getParent=function(){L("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new Ri(this.repo,e)},Ri.prototype.getRoot=function(){L("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},Ri.prototype.databaseProp=function(){return this.repo.database},Ri.prototype.set=function(e,t){L("Reference.set",1,2,arguments.length),Ke("Reference.set",this.path),He("Reference.set",1,e,this.path,!1),W("Reference.set",2,t,!0);var n=new f;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},Ri.prototype.update=function(e,t){if(L("Reference.update",1,2,arguments.length),Ke("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,se("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ve("Reference.update",1,e,this.path,!1),W("Reference.update",2,t,!0);var i=new f;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},Ri.prototype.setWithPriority=function(e,t,n){if(L("Reference.setWithPriority",2,3,arguments.length),Ke("Reference.setWithPriority",this.path),He("Reference.setWithPriority",1,e,this.path,!1),je("Reference.setWithPriority",2,t,!1),W("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new f;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},Ri.prototype.remove=function(e){return L("Reference.remove",0,1,arguments.length),Ke("Reference.remove",this.path),W("Reference.remove",1,e,!0),this.set(null,e)},Ri.prototype.transaction=function(e,t,n){if(L("Reference.transaction",1,3,arguments.length),Ke("Reference.transaction",this.path),W("Reference.transaction",1,e,!1),W("Reference.transaction",2,t,!0),function(e,t,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(M("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new f;return"function"==typeof t&&r.promise.catch((function(){})),this.repo.startTransaction(this.path,e,(function(e,n,i){e?r.reject(e):r.resolve(new rt(n,i)),"function"==typeof t&&t(e,n,i)}),n),r.promise},Ri.prototype.setPriority=function(e,t){L("Reference.setPriority",1,2,arguments.length),Ke("Reference.setPriority",this.path),je("Reference.setPriority",1,e,!1),W("Reference.setPriority",2,t,!0);var n=new f;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},Ri.prototype.push=function(e,t){L("Reference.push",0,2,arguments.length),Ke("Reference.push",this.path),He("Reference.push",1,e,this.path,!0),W("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=ht(r),o=this.child(i),s=this.child(i);return n=null!=e?o.set(e,t).then((function(){return s})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch((function(){})),o},Ri.prototype.onDisconnect=function(){return Ke("Reference.onDisconnect",this.path),new tt(this.repo,this.path)},Object.defineProperty(Ri.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Ri.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Ri.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Ri.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Ri);function Ri(e,t){if(!(e instanceof gi))throw new Error("new Reference() no longer supported - use app.database().");return Ii.call(this,e,t,Si.DEFAULT,!1)||this}gn.__referenceConstructor=Ni,yr.__referenceConstructor=Ni;var Pi,Oi,Di=function(){this.children={},this.childCount=0,this.value=null},xi=(Fi.prototype.subTree=function(e){for(var t=e instanceof Pe?e:new Pe(e),n=this,r=t.getFront();null!==r;)n=new Fi(r,n,R(n.node_.children,r)||new Di),r=(t=t.popFront()).getFront();return n},Fi.prototype.getValue=function(){return this.node_.value},Fi.prototype.setValue=function(e){c(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},Fi.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Fi.prototype.hasChildren=function(){return 0<this.node_.childCount},Fi.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Fi.prototype.forEachChild=function(e){var t=this;be(this.node_.children,(function(n,r){e(new Fi(n,t,r))}))},Fi.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild((function(t){t.forEachDescendant(e,!0,n)})),t&&n&&e(this)},Fi.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},Fi.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)}))},Fi.prototype.path=function(){return new Pe(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Fi.prototype.name=function(){return this.name_},Fi.prototype.parent=function(){return this.parent_},Fi.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Fi.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=N(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},Fi);function Fi(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new Di),this.name_=e,this.parent_=t,this.node_=n}(Oi=Pi=Pi||{})[Oi.RUN=0]="RUN",Oi[Oi.SENT=1]="SENT",Oi[Oi.COMPLETED=2]="COMPLETED",Oi[Oi.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Oi[Oi.NEEDS_ABORT=4]="NEEDS_ABORT",gi.MAX_TRANSACTION_RETRIES_=25,gi.prototype.transactionsInit_=function(){this.transactionQueueTree_=new xi},gi.prototype.startTransaction=function(e,t,n,r){function i(){}this.log_("transaction on "+e);var o=new Ni(this,e);o.on("value",i);var s={path:e,update:t,onComplete:n,status:null,order:ye(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=this.getLatestState_(e);s.currentInputSnapshot=a;var h=s.update(a.val());if(void 0===h){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var l=new an(s.currentInputSnapshot,new Ni(this,s.path),Rt);s.onComplete(null,!1,l)}}else{et("transaction failed: Data returned ",h,s.path),s.status=Pi.RUN;var u=this.transactionQueueTree_.subTree(e),p=u.getValue()||[];p.push(s),u.setValue(p);var d=void 0;"object"==typeof h&&null!==h&&N(h,".priority")?(d=R(h,".priority"),c(Ue(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(this.serverSyncTree_.calcCompleteEventCache(e)||Gt.EMPTY_NODE).getPriority().val(),d=d;var f=this.generateServerValues(),y=en(h,d),_=Tn(y,a,f);s.currentOutputSnapshotRaw=y,s.currentOutputSnapshotResolved=_,s.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(e,_,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,v),this.sendReadyTransactions_()}},gi.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||Gt.EMPTY_NODE},gi.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);c(0<n.length,"Sending zero length transaction queue"),n.every((function(e){return e.status===Pi.RUN}))&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild((function(e){t.sendReadyTransactions_(e)}))},gi.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map((function(e){return e.currentWriteId})),i=this.getLatestState_(e,r),o=i,s=i.hash(),a=0;a<t.length;a++){var h=t[a];c(h.status===Pi.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=Pi.SENT,h.retryCount++;var l=Pe.relativePath(e,h.path);o=o.updateChild(l,h.currentOutputSnapshotRaw)}var u=o.val(!0),p=e;this.server_.put(p.toString(),u,(function(r){n.log_("transaction put response",{path:p.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<t.length;s++){if(t[s].status=Pi.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[s].currentWriteId)),t[s].onComplete){var a=t[s].currentOutputSnapshotResolved,h=new Ni(n,t[s].path),l=new an(a,h,Rt);o.push(t[s].onComplete.bind(null,null,!0,l))}t[s].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i),s=0;s<o.length;s++)Te(o[s])}else{if("datastale"===r)for(s=0;s<t.length;s++)t[s].status===Pi.SENT_NEEDS_ABORT?t[s].status=Pi.NEEDS_ABORT:t[s].status=Pi.RUN;else for(se("transaction at "+p.toString()+" failed: "+r),s=0;s<t.length;s++)t[s].status=Pi.NEEDS_ABORT,t[s].abortReason=r;n.rerunTransactions_(e)}}),s)},gi.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},gi.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter((function(e){return e.status===Pi.RUN})).map((function(e){return e.currentWriteId})),s=0;s<e.length;s++){var a=e[s],h=Pe.relativePath(t,a.path),l=!1,u=void 0;if(c(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===Pi.NEEDS_ABORT)l=!0,u=a.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===Pi.RUN)if(a.retryCount>=gi.MAX_TRANSACTION_RETRIES_)l=!0,u="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var p=this.getLatestState_(a.path,o);a.currentInputSnapshot=p;var d=e[s].update(p.val());if(void 0!==d){et("transaction failed: Data returned ",d,a.path);var f=en(d);"object"==typeof d&&null!=d&&N(d,".priority")||(f=f.updatePriority(p.getPriority()));var y=a.currentWriteId,_=Tn(f,p,this.generateServerValues());a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=_,a.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(y),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(a.path,_,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(y,!0))}else l=!0,u="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,i),i=[],l&&(e[s].status=Pi.COMPLETED,n=e[s].unwatcher,setTimeout(n,Math.floor(0)),e[s].onComplete))if("nodata"===u){var v=new Ni(this,e[s].path),g=e[s].currentInputSnapshot,m=new an(g,v,Rt);r.push(e[s].onComplete.bind(null,null,!1,m))}else r.push(e[s].onComplete.bind(null,new Error(u),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),s=0;s<r.length;s++)Te(r[s]);this.sendReadyTransactions_()}},gi.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=e.getFront();null!==t&&null===n.getValue();)n=n.subTree(t),t=(e=e.popFront()).getFront();return n},gi.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort((function(e,t){return e.order-t.order})),t},gi.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild((function(e){n.aggregateTransactionQueuesForNode_(e,t)}))},gi.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Pi.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(0<n.length?n:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))},gi.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)})),n},gi.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)t[o].status!==Pi.SENT_NEEDS_ABORT&&(t[o].status===Pi.SENT?(c(i===o-1,"All SENT items should be at beginning of queue."),t[i=o].status=Pi.SENT_NEEDS_ABORT,t[o].abortReason="set"):(c(t[o].status===Pi.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?e.setValue(null):t.length=i+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r),o=0;o<n.length;o++)Te(n[o])}};var ki,Ai="databaseURL",Li=(Mi.getInstance=function(){return ki=ki||new Mi},Mi.prototype.interrupt=function(){var e,t,n,r;try{for(var o=i(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(n=void 0,i(Object.keys(this.repos_[a]))),l=h.next();!l.done;l=h.next()){var u=l.value;this.repos_[a][u].interrupt()}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},Mi.prototype.resume=function(){var e,t,n,r;try{for(var o=i(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(n=void 0,i(Object.keys(this.repos_[a]))),l=h.next();!l.done;l=h.next()){var u=l.value;this.repos_[a][u].resume()}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},Mi.prototype.databaseFromApp=function(e,t,n){var r=n||e.options[Ai];void 0===r&&oe("Can't determine Firebase Database URL.  Be sure to include "+Ai+" option when calling firebase.initializeApp().");var i=We(r),o=i.repoInfo,s=void 0;return"undefined"!=typeof process&&(s=process.env.FIREBASE_DATABASE_EMULATOR_HOST),s&&(o=(i=We(r="http://"+s+"?ns="+o.namespace)).repoInfo),Ge("Invalid Firebase Database URL",1,i),i.path.isEmpty()||oe("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,e,t).database},Mi.prototype.deleteRepo=function(e){var t=R(this.repos_,e.app.name);t&&R(t,e.repoInfo_.toURLString())===e||oe("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},Mi.prototype.createRepo=function(e,t,n){var r=R(this.repos_,t.name);r||(r={},this.repos_[t.name]=r);var i=R(r,e.toURLString());return i&&oe("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new gi(e,this.useRestClient_,t,n),r[e.toURLString()]=i},Mi.prototype.forceRestClient=function(e){this.useRestClient_=e},Mi);function Mi(){this.repos_={},this.useRestClient_=!1}var Wi=(Object.defineProperty(Qi.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),Qi.prototype.ref=function(e){return this.checkDeleted_("ref"),L("database.ref",0,1,arguments.length),e instanceof Ni?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},Qi.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),L(t,1,1,arguments.length);var n=We(e);Ge(t,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&oe(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},Qi.prototype.checkDeleted_=function(e){null===this.repo_&&oe("Cannot call "+e+" on a deleted database.")},Qi.prototype.goOffline=function(){L("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},Qi.prototype.goOnline=function(){L("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},Qi.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},Qi);function Qi(e){(this.repo_=e)instanceof gi||oe("Don't call new Database() directly - please use firebase.database()."),this.root_=new Ni(e,Pe.Empty),this.INTERNAL=new qi(this)}var qi=(Ui.prototype.delete=function(){return function(e,t,n,r){return new(n=n||Promise)((function(i,o){function s(e){try{h(r.next(e))}catch(e){o(e)}}function a(e){try{h(r.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(s,a)}h((r=r.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){return function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){return this.database.checkDeleted_("delete"),Li.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},Ui);function Ui(e){this.database=e}var Hi=Object.freeze({__proto__:null,forceLongPolling:function(){ri.forceDisallow(),$r.forceAllow()},forceWebSockets:function(){$r.forceDisallow()},isWebSocketsAvailable:function(){return ri.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)}}),Vi=pi;pi.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},pi.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var ji,Bi,zi=ai,Yi=Le,Ki=Object.freeze({__proto__:null,DataConnection:Vi,RealTimeConnection:zi,hijackHash:function(e){var t=pi.prototype.put;return pi.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){pi.prototype.put=t}},ConnectionTarget:Yi,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){Li.getInstance().forceRestClient(e)}}),Gi=Wi.ServerValue;Bi=(ji=e).SDK_VERSION,ti=Bi,ji.INTERNAL.registerComponent(new Y("database",(function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return Li.getInstance().databaseFromApp(n,r,t)}),"PUBLIC").setServiceProps({Reference:Ni,Query:gn,Database:Wi,DataSnapshot:an,enableLogging:te,INTERNAL:Hi,ServerValue:Gi,TEST_ACCESS:Ki}).setMultipleInstances(!0)),ji.registerVersion("@firebase/database","0.6.3")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-database.js - be sure to load firebase-app.js first.")}},"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e=e||self).firebase);